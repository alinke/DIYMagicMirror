<!-- saved from url=(0014)about:internet -->
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8"/>
<title>JPEGAsyncEncoder.as</title>
<link rel="stylesheet" type="text/css" href="../../../../SourceStyles.css"/>
</head>

<body><pre><span class="ActionScriptComment">//////////////////////////////////////////////////////////////////////////////
</span><span class="ActionScriptComment">//
</span><span class="ActionScriptComment">//  Copyright (C) 2003-2007 Adobe Systems Incorporated.
</span><span class="ActionScriptComment">//  All Rights Reserved. The following is Source Code and is subject to all
</span><span class="ActionScriptComment">//  restrictions on such code as contained in the End User License Agreement
</span><span class="ActionScriptComment">//  accompanying this product.
</span><span class="ActionScriptComment">//
</span><span class="ActionScriptComment">////////////////////////////////////////////////////////////////////////////////
</span>
<span class="ActionScriptComment">//////////////////////////////////////////////////////////////////////////////
</span><span class="ActionScriptComment">//
</span><span class="ActionScriptComment">//  Original Code from mx.graphics.codec.JPEGEncoder 
</span><span class="ActionScriptComment">//  Code has been heavily modified by Paraniod Ferret Productions
</span><span class="ActionScriptComment">//  Date: 12-09-2007
</span><span class="ActionScriptComment">//  
</span><span class="ActionScriptComment">////////////////////////////////////////////////////////////////////////////////
</span>
<span class="ActionScriptpackage">package</span> <span class="ActionScriptDefault_Text">com</span>.<span class="ActionScriptDefault_Text">pfp</span>.<span class="ActionScriptDefault_Text">utils</span>
<span class="ActionScriptBracket/Brace">{</span>
<span class="ActionScriptReserved">import</span> <span class="ActionScriptDefault_Text">com</span>.<span class="ActionScriptDefault_Text">pfp</span>.<span class="ActionScriptDefault_Text">events</span>.<span class="ActionScriptDefault_Text">JPEGAsyncCompleteEvent</span>;

<span class="ActionScriptReserved">import</span> <span class="ActionScriptDefault_Text">flash</span>.<span class="ActionScriptDefault_Text">display</span>.<span class="ActionScriptDefault_Text">BitmapData</span>;
<span class="ActionScriptReserved">import</span> <span class="ActionScriptDefault_Text">flash</span>.<span class="ActionScriptDefault_Text">events</span>.<span class="ActionScriptDefault_Text">EventDispatcher</span>;
<span class="ActionScriptReserved">import</span> <span class="ActionScriptDefault_Text">flash</span>.<span class="ActionScriptDefault_Text">events</span>.<span class="ActionScriptDefault_Text">ProgressEvent</span>;
<span class="ActionScriptReserved">import</span> <span class="ActionScriptDefault_Text">flash</span>.<span class="ActionScriptDefault_Text">utils</span>.<span class="ActionScriptDefault_Text">ByteArray</span>;
<span class="ActionScriptReserved">import</span> <span class="ActionScriptDefault_Text">flash</span>.<span class="ActionScriptDefault_Text">utils</span>.<span class="ActionScriptDefault_Text">setTimeout</span>;

<span class="ActionScriptBracket/Brace">[</span><span class="ActionScriptMetadata">Event</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">name</span><span class="ActionScriptOperator">=</span><span class="ActionScriptDefault_Text">JPEGAsyncCompleteEvent</span>.<span class="ActionScriptDefault_Text">JPEGASYNC_COMPLETE</span>, <span class="ActionScriptDefault_Text">type</span><span class="ActionScriptOperator">=</span><span class="ActionScriptString">&quot;com.pfp.events.JPEGAsyncCompleteEvent&quot;</span><span class="ActionScriptBracket/Brace">)]</span>
<span class="ActionScriptBracket/Brace">[</span><span class="ActionScriptMetadata">Event</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">name</span><span class="ActionScriptOperator">=</span><span class="ActionScriptDefault_Text">ProgressEvent</span>.<span class="ActionScriptDefault_Text">PROGRESS</span>, <span class="ActionScriptDefault_Text">type</span><span class="ActionScriptOperator">=</span><span class="ActionScriptString">&quot;flash.events.ProgressEvent&quot;</span><span class="ActionScriptBracket/Brace">)]</span>
<span class="ActionScriptReserved">public</span> <span class="ActionScriptclass">class</span> <span class="ActionScriptDefault_Text">JPEGAsyncEncoder</span> <span class="ActionScriptReserved">extends</span> <span class="ActionScriptDefault_Text">EventDispatcher</span>
<span class="ActionScriptBracket/Brace">{</span>
    <span class="ActionScriptReserved">public</span> <span class="ActionScriptReserved">static</span> <span class="ActionScriptReserved">const</span> <span class="ActionScriptDefault_Text">CONTENT_TYPE</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">String</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptString">&quot;image/jpeg&quot;</span>;
        
    <span class="ActionScriptReserved">private</span> <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">ZigZag</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">Array</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptBracket/Brace">[</span>
         0, 1, 5, 6,14,15,27,28,
         2, 4, 7,13,16,26,29,42,
         3, 8,12,17,25,30,41,43,
         9,11,18,24,31,40,44,53,
        10,19,23,32,39,45,52,54,
        20,22,33,38,46,51,55,60,
        21,34,37,47,50,56,59,61,
        35,36,48,49,57,58,62,63
    <span class="ActionScriptBracket/Brace">]</span>;
    
    <span class="ActionScriptReserved">private</span> <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">std_dc_luminance_nrcodes</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">Array</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptBracket/Brace">[</span>0,0,1,5,1,1,1,1,1,1,0,0,0,0,0,0,0<span class="ActionScriptBracket/Brace">]</span>;
    <span class="ActionScriptReserved">private</span> <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">std_dc_luminance_values</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">Array</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptBracket/Brace">[</span>0,1,2,3,4,5,6,7,8,9,10,11<span class="ActionScriptBracket/Brace">]</span>;
    <span class="ActionScriptReserved">private</span> <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">std_ac_luminance_nrcodes</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">Array</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptBracket/Brace">[</span>0,0,2,1,3,3,2,4,3,5,5,4,4,0,0,1,0<span class="ActionScriptDefault_Text">x7d</span><span class="ActionScriptBracket/Brace">]</span>;
    <span class="ActionScriptReserved">private</span> <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">std_ac_luminance_values</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">Array</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptBracket/Brace">[</span>
        0<span class="ActionScriptDefault_Text">x01</span>,0<span class="ActionScriptDefault_Text">x02</span>,0<span class="ActionScriptDefault_Text">x03</span>,0<span class="ActionScriptDefault_Text">x00</span>,0<span class="ActionScriptDefault_Text">x04</span>,0<span class="ActionScriptDefault_Text">x11</span>,0<span class="ActionScriptDefault_Text">x05</span>,0<span class="ActionScriptDefault_Text">x12</span>,
        0<span class="ActionScriptDefault_Text">x21</span>,0<span class="ActionScriptDefault_Text">x31</span>,0<span class="ActionScriptDefault_Text">x41</span>,0<span class="ActionScriptDefault_Text">x06</span>,0<span class="ActionScriptDefault_Text">x13</span>,0<span class="ActionScriptDefault_Text">x51</span>,0<span class="ActionScriptDefault_Text">x61</span>,0<span class="ActionScriptDefault_Text">x07</span>,
        0<span class="ActionScriptDefault_Text">x22</span>,0<span class="ActionScriptDefault_Text">x71</span>,0<span class="ActionScriptDefault_Text">x14</span>,0<span class="ActionScriptDefault_Text">x32</span>,0<span class="ActionScriptDefault_Text">x81</span>,0<span class="ActionScriptDefault_Text">x91</span>,0<span class="ActionScriptDefault_Text">xa1</span>,0<span class="ActionScriptDefault_Text">x08</span>,
        0<span class="ActionScriptDefault_Text">x23</span>,0<span class="ActionScriptDefault_Text">x42</span>,0<span class="ActionScriptDefault_Text">xb1</span>,0<span class="ActionScriptDefault_Text">xc1</span>,0<span class="ActionScriptDefault_Text">x15</span>,0<span class="ActionScriptDefault_Text">x52</span>,0<span class="ActionScriptDefault_Text">xd1</span>,0<span class="ActionScriptDefault_Text">xf0</span>,
        0<span class="ActionScriptDefault_Text">x24</span>,0<span class="ActionScriptDefault_Text">x33</span>,0<span class="ActionScriptDefault_Text">x62</span>,0<span class="ActionScriptDefault_Text">x72</span>,0<span class="ActionScriptDefault_Text">x82</span>,0<span class="ActionScriptDefault_Text">x09</span>,0<span class="ActionScriptDefault_Text">x0a</span>,0<span class="ActionScriptDefault_Text">x16</span>,
        0<span class="ActionScriptDefault_Text">x17</span>,0<span class="ActionScriptDefault_Text">x18</span>,0<span class="ActionScriptDefault_Text">x19</span>,0<span class="ActionScriptDefault_Text">x1a</span>,0<span class="ActionScriptDefault_Text">x25</span>,0<span class="ActionScriptDefault_Text">x26</span>,0<span class="ActionScriptDefault_Text">x27</span>,0<span class="ActionScriptDefault_Text">x28</span>,
        0<span class="ActionScriptDefault_Text">x29</span>,0<span class="ActionScriptDefault_Text">x2a</span>,0<span class="ActionScriptDefault_Text">x34</span>,0<span class="ActionScriptDefault_Text">x35</span>,0<span class="ActionScriptDefault_Text">x36</span>,0<span class="ActionScriptDefault_Text">x37</span>,0<span class="ActionScriptDefault_Text">x38</span>,0<span class="ActionScriptDefault_Text">x39</span>,
        0<span class="ActionScriptDefault_Text">x3a</span>,0<span class="ActionScriptDefault_Text">x43</span>,0<span class="ActionScriptDefault_Text">x44</span>,0<span class="ActionScriptDefault_Text">x45</span>,0<span class="ActionScriptDefault_Text">x46</span>,0<span class="ActionScriptDefault_Text">x47</span>,0<span class="ActionScriptDefault_Text">x48</span>,0<span class="ActionScriptDefault_Text">x49</span>,
        0<span class="ActionScriptDefault_Text">x4a</span>,0<span class="ActionScriptDefault_Text">x53</span>,0<span class="ActionScriptDefault_Text">x54</span>,0<span class="ActionScriptDefault_Text">x55</span>,0<span class="ActionScriptDefault_Text">x56</span>,0<span class="ActionScriptDefault_Text">x57</span>,0<span class="ActionScriptDefault_Text">x58</span>,0<span class="ActionScriptDefault_Text">x59</span>,
        0<span class="ActionScriptDefault_Text">x5a</span>,0<span class="ActionScriptDefault_Text">x63</span>,0<span class="ActionScriptDefault_Text">x64</span>,0<span class="ActionScriptDefault_Text">x65</span>,0<span class="ActionScriptDefault_Text">x66</span>,0<span class="ActionScriptDefault_Text">x67</span>,0<span class="ActionScriptDefault_Text">x68</span>,0<span class="ActionScriptDefault_Text">x69</span>,
        0<span class="ActionScriptDefault_Text">x6a</span>,0<span class="ActionScriptDefault_Text">x73</span>,0<span class="ActionScriptDefault_Text">x74</span>,0<span class="ActionScriptDefault_Text">x75</span>,0<span class="ActionScriptDefault_Text">x76</span>,0<span class="ActionScriptDefault_Text">x77</span>,0<span class="ActionScriptDefault_Text">x78</span>,0<span class="ActionScriptDefault_Text">x79</span>,
        0<span class="ActionScriptDefault_Text">x7a</span>,0<span class="ActionScriptDefault_Text">x83</span>,0<span class="ActionScriptDefault_Text">x84</span>,0<span class="ActionScriptDefault_Text">x85</span>,0<span class="ActionScriptDefault_Text">x86</span>,0<span class="ActionScriptDefault_Text">x87</span>,0<span class="ActionScriptDefault_Text">x88</span>,0<span class="ActionScriptDefault_Text">x89</span>,
        0<span class="ActionScriptDefault_Text">x8a</span>,0<span class="ActionScriptDefault_Text">x92</span>,0<span class="ActionScriptDefault_Text">x93</span>,0<span class="ActionScriptDefault_Text">x94</span>,0<span class="ActionScriptDefault_Text">x95</span>,0<span class="ActionScriptDefault_Text">x96</span>,0<span class="ActionScriptDefault_Text">x97</span>,0<span class="ActionScriptDefault_Text">x98</span>,
        0<span class="ActionScriptDefault_Text">x99</span>,0<span class="ActionScriptDefault_Text">x9a</span>,0<span class="ActionScriptDefault_Text">xa2</span>,0<span class="ActionScriptDefault_Text">xa3</span>,0<span class="ActionScriptDefault_Text">xa4</span>,0<span class="ActionScriptDefault_Text">xa5</span>,0<span class="ActionScriptDefault_Text">xa6</span>,0<span class="ActionScriptDefault_Text">xa7</span>,
        0<span class="ActionScriptDefault_Text">xa8</span>,0<span class="ActionScriptDefault_Text">xa9</span>,0<span class="ActionScriptDefault_Text">xaa</span>,0<span class="ActionScriptDefault_Text">xb2</span>,0<span class="ActionScriptDefault_Text">xb3</span>,0<span class="ActionScriptDefault_Text">xb4</span>,0<span class="ActionScriptDefault_Text">xb5</span>,0<span class="ActionScriptDefault_Text">xb6</span>,
        0<span class="ActionScriptDefault_Text">xb7</span>,0<span class="ActionScriptDefault_Text">xb8</span>,0<span class="ActionScriptDefault_Text">xb9</span>,0<span class="ActionScriptDefault_Text">xba</span>,0<span class="ActionScriptDefault_Text">xc2</span>,0<span class="ActionScriptDefault_Text">xc3</span>,0<span class="ActionScriptDefault_Text">xc4</span>,0<span class="ActionScriptDefault_Text">xc5</span>,
        0<span class="ActionScriptDefault_Text">xc6</span>,0<span class="ActionScriptDefault_Text">xc7</span>,0<span class="ActionScriptDefault_Text">xc8</span>,0<span class="ActionScriptDefault_Text">xc9</span>,0<span class="ActionScriptDefault_Text">xca</span>,0<span class="ActionScriptDefault_Text">xd2</span>,0<span class="ActionScriptDefault_Text">xd3</span>,0<span class="ActionScriptDefault_Text">xd4</span>,
        0<span class="ActionScriptDefault_Text">xd5</span>,0<span class="ActionScriptDefault_Text">xd6</span>,0<span class="ActionScriptDefault_Text">xd7</span>,0<span class="ActionScriptDefault_Text">xd8</span>,0<span class="ActionScriptDefault_Text">xd9</span>,0<span class="ActionScriptDefault_Text">xda</span>,0<span class="ActionScriptDefault_Text">xe1</span>,0<span class="ActionScriptDefault_Text">xe2</span>,
        0<span class="ActionScriptDefault_Text">xe3</span>,0<span class="ActionScriptDefault_Text">xe4</span>,0<span class="ActionScriptDefault_Text">xe5</span>,0<span class="ActionScriptDefault_Text">xe6</span>,0<span class="ActionScriptDefault_Text">xe7</span>,0<span class="ActionScriptDefault_Text">xe8</span>,0<span class="ActionScriptDefault_Text">xe9</span>,0<span class="ActionScriptDefault_Text">xea</span>,
        0<span class="ActionScriptDefault_Text">xf1</span>,0<span class="ActionScriptDefault_Text">xf2</span>,0<span class="ActionScriptDefault_Text">xf3</span>,0<span class="ActionScriptDefault_Text">xf4</span>,0<span class="ActionScriptDefault_Text">xf5</span>,0<span class="ActionScriptDefault_Text">xf6</span>,0<span class="ActionScriptDefault_Text">xf7</span>,0<span class="ActionScriptDefault_Text">xf8</span>,
        0<span class="ActionScriptDefault_Text">xf9</span>,0<span class="ActionScriptDefault_Text">xfa</span>
    <span class="ActionScriptBracket/Brace">]</span>;

    <span class="ActionScriptReserved">private</span> <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">std_dc_chrominance_nrcodes</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">Array</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptBracket/Brace">[</span>0,0,3,1,1,1,1,1,1,1,1,1,0,0,0,0,0<span class="ActionScriptBracket/Brace">]</span>;
    <span class="ActionScriptReserved">private</span> <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">std_dc_chrominance_values</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">Array</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptBracket/Brace">[</span>0,1,2,3,4,5,6,7,8,9,10,11<span class="ActionScriptBracket/Brace">]</span>;
    <span class="ActionScriptReserved">private</span> <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">std_ac_chrominance_nrcodes</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">Array</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptBracket/Brace">[</span>0,0,2,1,2,4,4,3,4,7,5,4,4,0,1,2,0<span class="ActionScriptDefault_Text">x77</span><span class="ActionScriptBracket/Brace">]</span>;
    <span class="ActionScriptReserved">private</span> <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">std_ac_chrominance_values</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">Array</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptBracket/Brace">[</span>
        0<span class="ActionScriptDefault_Text">x00</span>,0<span class="ActionScriptDefault_Text">x01</span>,0<span class="ActionScriptDefault_Text">x02</span>,0<span class="ActionScriptDefault_Text">x03</span>,0<span class="ActionScriptDefault_Text">x11</span>,0<span class="ActionScriptDefault_Text">x04</span>,0<span class="ActionScriptDefault_Text">x05</span>,0<span class="ActionScriptDefault_Text">x21</span>,
        0<span class="ActionScriptDefault_Text">x31</span>,0<span class="ActionScriptDefault_Text">x06</span>,0<span class="ActionScriptDefault_Text">x12</span>,0<span class="ActionScriptDefault_Text">x41</span>,0<span class="ActionScriptDefault_Text">x51</span>,0<span class="ActionScriptDefault_Text">x07</span>,0<span class="ActionScriptDefault_Text">x61</span>,0<span class="ActionScriptDefault_Text">x71</span>,
        0<span class="ActionScriptDefault_Text">x13</span>,0<span class="ActionScriptDefault_Text">x22</span>,0<span class="ActionScriptDefault_Text">x32</span>,0<span class="ActionScriptDefault_Text">x81</span>,0<span class="ActionScriptDefault_Text">x08</span>,0<span class="ActionScriptDefault_Text">x14</span>,0<span class="ActionScriptDefault_Text">x42</span>,0<span class="ActionScriptDefault_Text">x91</span>,
        0<span class="ActionScriptDefault_Text">xa1</span>,0<span class="ActionScriptDefault_Text">xb1</span>,0<span class="ActionScriptDefault_Text">xc1</span>,0<span class="ActionScriptDefault_Text">x09</span>,0<span class="ActionScriptDefault_Text">x23</span>,0<span class="ActionScriptDefault_Text">x33</span>,0<span class="ActionScriptDefault_Text">x52</span>,0<span class="ActionScriptDefault_Text">xf0</span>,
        0<span class="ActionScriptDefault_Text">x15</span>,0<span class="ActionScriptDefault_Text">x62</span>,0<span class="ActionScriptDefault_Text">x72</span>,0<span class="ActionScriptDefault_Text">xd1</span>,0<span class="ActionScriptDefault_Text">x0a</span>,0<span class="ActionScriptDefault_Text">x16</span>,0<span class="ActionScriptDefault_Text">x24</span>,0<span class="ActionScriptDefault_Text">x34</span>,
        0<span class="ActionScriptDefault_Text">xe1</span>,0<span class="ActionScriptDefault_Text">x25</span>,0<span class="ActionScriptDefault_Text">xf1</span>,0<span class="ActionScriptDefault_Text">x17</span>,0<span class="ActionScriptDefault_Text">x18</span>,0<span class="ActionScriptDefault_Text">x19</span>,0<span class="ActionScriptDefault_Text">x1a</span>,0<span class="ActionScriptDefault_Text">x26</span>,
        0<span class="ActionScriptDefault_Text">x27</span>,0<span class="ActionScriptDefault_Text">x28</span>,0<span class="ActionScriptDefault_Text">x29</span>,0<span class="ActionScriptDefault_Text">x2a</span>,0<span class="ActionScriptDefault_Text">x35</span>,0<span class="ActionScriptDefault_Text">x36</span>,0<span class="ActionScriptDefault_Text">x37</span>,0<span class="ActionScriptDefault_Text">x38</span>,
        0<span class="ActionScriptDefault_Text">x39</span>,0<span class="ActionScriptDefault_Text">x3a</span>,0<span class="ActionScriptDefault_Text">x43</span>,0<span class="ActionScriptDefault_Text">x44</span>,0<span class="ActionScriptDefault_Text">x45</span>,0<span class="ActionScriptDefault_Text">x46</span>,0<span class="ActionScriptDefault_Text">x47</span>,0<span class="ActionScriptDefault_Text">x48</span>,
        0<span class="ActionScriptDefault_Text">x49</span>,0<span class="ActionScriptDefault_Text">x4a</span>,0<span class="ActionScriptDefault_Text">x53</span>,0<span class="ActionScriptDefault_Text">x54</span>,0<span class="ActionScriptDefault_Text">x55</span>,0<span class="ActionScriptDefault_Text">x56</span>,0<span class="ActionScriptDefault_Text">x57</span>,0<span class="ActionScriptDefault_Text">x58</span>,
        0<span class="ActionScriptDefault_Text">x59</span>,0<span class="ActionScriptDefault_Text">x5a</span>,0<span class="ActionScriptDefault_Text">x63</span>,0<span class="ActionScriptDefault_Text">x64</span>,0<span class="ActionScriptDefault_Text">x65</span>,0<span class="ActionScriptDefault_Text">x66</span>,0<span class="ActionScriptDefault_Text">x67</span>,0<span class="ActionScriptDefault_Text">x68</span>,
        0<span class="ActionScriptDefault_Text">x69</span>,0<span class="ActionScriptDefault_Text">x6a</span>,0<span class="ActionScriptDefault_Text">x73</span>,0<span class="ActionScriptDefault_Text">x74</span>,0<span class="ActionScriptDefault_Text">x75</span>,0<span class="ActionScriptDefault_Text">x76</span>,0<span class="ActionScriptDefault_Text">x77</span>,0<span class="ActionScriptDefault_Text">x78</span>,
        0<span class="ActionScriptDefault_Text">x79</span>,0<span class="ActionScriptDefault_Text">x7a</span>,0<span class="ActionScriptDefault_Text">x82</span>,0<span class="ActionScriptDefault_Text">x83</span>,0<span class="ActionScriptDefault_Text">x84</span>,0<span class="ActionScriptDefault_Text">x85</span>,0<span class="ActionScriptDefault_Text">x86</span>,0<span class="ActionScriptDefault_Text">x87</span>,
        0<span class="ActionScriptDefault_Text">x88</span>,0<span class="ActionScriptDefault_Text">x89</span>,0<span class="ActionScriptDefault_Text">x8a</span>,0<span class="ActionScriptDefault_Text">x92</span>,0<span class="ActionScriptDefault_Text">x93</span>,0<span class="ActionScriptDefault_Text">x94</span>,0<span class="ActionScriptDefault_Text">x95</span>,0<span class="ActionScriptDefault_Text">x96</span>,
        0<span class="ActionScriptDefault_Text">x97</span>,0<span class="ActionScriptDefault_Text">x98</span>,0<span class="ActionScriptDefault_Text">x99</span>,0<span class="ActionScriptDefault_Text">x9a</span>,0<span class="ActionScriptDefault_Text">xa2</span>,0<span class="ActionScriptDefault_Text">xa3</span>,0<span class="ActionScriptDefault_Text">xa4</span>,0<span class="ActionScriptDefault_Text">xa5</span>,
        0<span class="ActionScriptDefault_Text">xa6</span>,0<span class="ActionScriptDefault_Text">xa7</span>,0<span class="ActionScriptDefault_Text">xa8</span>,0<span class="ActionScriptDefault_Text">xa9</span>,0<span class="ActionScriptDefault_Text">xaa</span>,0<span class="ActionScriptDefault_Text">xb2</span>,0<span class="ActionScriptDefault_Text">xb3</span>,0<span class="ActionScriptDefault_Text">xb4</span>,
        0<span class="ActionScriptDefault_Text">xb5</span>,0<span class="ActionScriptDefault_Text">xb6</span>,0<span class="ActionScriptDefault_Text">xb7</span>,0<span class="ActionScriptDefault_Text">xb8</span>,0<span class="ActionScriptDefault_Text">xb9</span>,0<span class="ActionScriptDefault_Text">xba</span>,0<span class="ActionScriptDefault_Text">xc2</span>,0<span class="ActionScriptDefault_Text">xc3</span>,
        0<span class="ActionScriptDefault_Text">xc4</span>,0<span class="ActionScriptDefault_Text">xc5</span>,0<span class="ActionScriptDefault_Text">xc6</span>,0<span class="ActionScriptDefault_Text">xc7</span>,0<span class="ActionScriptDefault_Text">xc8</span>,0<span class="ActionScriptDefault_Text">xc9</span>,0<span class="ActionScriptDefault_Text">xca</span>,0<span class="ActionScriptDefault_Text">xd2</span>,
        0<span class="ActionScriptDefault_Text">xd3</span>,0<span class="ActionScriptDefault_Text">xd4</span>,0<span class="ActionScriptDefault_Text">xd5</span>,0<span class="ActionScriptDefault_Text">xd6</span>,0<span class="ActionScriptDefault_Text">xd7</span>,0<span class="ActionScriptDefault_Text">xd8</span>,0<span class="ActionScriptDefault_Text">xd9</span>,0<span class="ActionScriptDefault_Text">xda</span>,
        0<span class="ActionScriptDefault_Text">xe2</span>,0<span class="ActionScriptDefault_Text">xe3</span>,0<span class="ActionScriptDefault_Text">xe4</span>,0<span class="ActionScriptDefault_Text">xe5</span>,0<span class="ActionScriptDefault_Text">xe6</span>,0<span class="ActionScriptDefault_Text">xe7</span>,0<span class="ActionScriptDefault_Text">xe8</span>,0<span class="ActionScriptDefault_Text">xe9</span>,
        0<span class="ActionScriptDefault_Text">xea</span>,0<span class="ActionScriptDefault_Text">xf2</span>,0<span class="ActionScriptDefault_Text">xf3</span>,0<span class="ActionScriptDefault_Text">xf4</span>,0<span class="ActionScriptDefault_Text">xf5</span>,0<span class="ActionScriptDefault_Text">xf6</span>,0<span class="ActionScriptDefault_Text">xf7</span>,0<span class="ActionScriptDefault_Text">xf8</span>,
        0<span class="ActionScriptDefault_Text">xf9</span>,0<span class="ActionScriptDefault_Text">xfa</span>
    <span class="ActionScriptBracket/Brace">]</span>;


    <span class="ActionScriptReserved">private</span> <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">YTable</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">Array</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptReserved">new</span> <span class="ActionScriptDefault_Text">Array</span><span class="ActionScriptBracket/Brace">(</span>64<span class="ActionScriptBracket/Brace">)</span>;
    <span class="ActionScriptReserved">private</span> <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">UVTable</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">Array</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptReserved">new</span> <span class="ActionScriptDefault_Text">Array</span><span class="ActionScriptBracket/Brace">(</span>64<span class="ActionScriptBracket/Brace">)</span>;
    <span class="ActionScriptReserved">private</span> <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">fdtbl_Y</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">Array</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptReserved">new</span> <span class="ActionScriptDefault_Text">Array</span><span class="ActionScriptBracket/Brace">(</span>64<span class="ActionScriptBracket/Brace">)</span>;
    <span class="ActionScriptReserved">private</span> <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">fdtbl_UV</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">Array</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptReserved">new</span> <span class="ActionScriptDefault_Text">Array</span><span class="ActionScriptBracket/Brace">(</span>64<span class="ActionScriptBracket/Brace">)</span>;
    
    <span class="ActionScriptReserved">private</span> <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">YDC_HT</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">Array</span>;
    <span class="ActionScriptReserved">private</span> <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">UVDC_HT</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">Array</span>;
    <span class="ActionScriptReserved">private</span> <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">YAC_HT</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">Array</span>;
    <span class="ActionScriptReserved">private</span> <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">UVAC_HT</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">Array</span>;
    
    <span class="ActionScriptReserved">private</span> <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">YDU</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">Array</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptReserved">new</span> <span class="ActionScriptDefault_Text">Array</span><span class="ActionScriptBracket/Brace">(</span>64<span class="ActionScriptBracket/Brace">)</span>;
    <span class="ActionScriptReserved">private</span> <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">UDU</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">Array</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptReserved">new</span> <span class="ActionScriptDefault_Text">Array</span><span class="ActionScriptBracket/Brace">(</span>64<span class="ActionScriptBracket/Brace">)</span>;
    <span class="ActionScriptReserved">private</span> <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">VDU</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">Array</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptReserved">new</span> <span class="ActionScriptDefault_Text">Array</span><span class="ActionScriptBracket/Brace">(</span>64<span class="ActionScriptBracket/Brace">)</span>;
    
    <span class="ActionScriptReserved">private</span> <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">DU</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">Array</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptReserved">new</span> <span class="ActionScriptDefault_Text">Array</span><span class="ActionScriptBracket/Brace">(</span>64<span class="ActionScriptBracket/Brace">)</span>;
    
    <span class="ActionScriptReserved">private</span> <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">bitcode</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">Array</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptReserved">new</span> <span class="ActionScriptDefault_Text">Array</span><span class="ActionScriptBracket/Brace">(</span>65535<span class="ActionScriptBracket/Brace">)</span>;
    <span class="ActionScriptReserved">private</span> <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">category</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">Array</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptReserved">new</span> <span class="ActionScriptDefault_Text">Array</span><span class="ActionScriptBracket/Brace">(</span>65535<span class="ActionScriptBracket/Brace">)</span>;

    <span class="ActionScriptReserved">private</span> <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">byteout</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">ByteArray</span>;
    <span class="ActionScriptReserved">private</span> <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">bytenew</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">int</span> <span class="ActionScriptOperator">=</span> 0;
    <span class="ActionScriptReserved">private</span> <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">bytepos</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">int</span> <span class="ActionScriptOperator">=</span> 7;
    
    <span class="ActionScriptReserved">private</span> <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">DCY</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">Number</span> <span class="ActionScriptOperator">=</span> 0;
    <span class="ActionScriptReserved">private</span> <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">DCU</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">Number</span> <span class="ActionScriptOperator">=</span> 0;
    <span class="ActionScriptReserved">private</span> <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">DCV</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">Number</span> <span class="ActionScriptOperator">=</span> 0;
    <span class="ActionScriptReserved">private</span> <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">SrcWidth</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">int</span> <span class="ActionScriptOperator">=</span> 0;
    <span class="ActionScriptReserved">private</span> <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">SrcHeight</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">int</span> <span class="ActionScriptOperator">=</span> 0;
    <span class="ActionScriptReserved">private</span> <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">Source</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">Object</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptReserved">null</span>;
    <span class="ActionScriptReserved">private</span> <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">TotalSize</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">int</span> <span class="ActionScriptOperator">=</span> 0; 
    <span class="ActionScriptReserved">private</span> <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">PixelsPerIter</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">int</span> <span class="ActionScriptOperator">=</span> 128;
    <span class="ActionScriptReserved">private</span> <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">PercentageInc</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">int</span> <span class="ActionScriptOperator">=</span> 0;
    <span class="ActionScriptReserved">private</span> <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">NextProgressAt</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">int</span> <span class="ActionScriptOperator">=</span> 0;
    <span class="ActionScriptReserved">private</span> <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">CurrentTotalPos</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">int</span> <span class="ActionScriptOperator">=</span> 0;
    <span class="ActionScriptReserved">private</span> <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">Working</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">Boolean</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptReserved">false</span>;
        
    <span class="ActionScriptReserved">public</span> <span class="ActionScriptfunction">function</span> <span class="ActionScriptDefault_Text">JPEGAsyncEncoder</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">quality</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">Number</span><span class="ActionScriptOperator">=</span>50<span class="ActionScriptBracket/Brace">)</span>
    <span class="ActionScriptBracket/Brace">{</span>
        <span class="ActionScriptReserved">if</span> <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">quality</span> <span class="ActionScriptOperator">&lt;=</span> 0<span class="ActionScriptBracket/Brace">)</span>
            <span class="ActionScriptDefault_Text">quality</span> <span class="ActionScriptOperator">=</span> 1;

        <span class="ActionScriptReserved">if</span> <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">quality</span> <span class="ActionScriptOperator">&gt;</span> 100<span class="ActionScriptBracket/Brace">)</span>
            <span class="ActionScriptDefault_Text">quality</span> <span class="ActionScriptOperator">=</span> 100;

        <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">sf</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">int</span> <span class="ActionScriptOperator">=</span> 0;
        <span class="ActionScriptReserved">if</span> <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">quality</span> <span class="ActionScriptOperator">&lt;</span> 50<span class="ActionScriptBracket/Brace">)</span>
            <span class="ActionScriptDefault_Text">sf</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">int</span><span class="ActionScriptBracket/Brace">(</span>5000 <span class="ActionScriptOperator">/</span> <span class="ActionScriptDefault_Text">quality</span><span class="ActionScriptBracket/Brace">)</span>;
        <span class="ActionScriptReserved">else</span>
            <span class="ActionScriptDefault_Text">sf</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">int</span><span class="ActionScriptBracket/Brace">(</span>200 <span class="ActionScriptOperator">-</span> <span class="ActionScriptDefault_Text">quality</span> <span class="ActionScriptOperator">*</span> 2<span class="ActionScriptBracket/Brace">)</span>;

        <span class="ActionScriptComment">// Create tables
</span>        <span class="ActionScriptDefault_Text">initHuffmanTbl</span><span class="ActionScriptBracket/Brace">()</span>;
        <span class="ActionScriptDefault_Text">initCategoryNumber</span><span class="ActionScriptBracket/Brace">()</span>;
        <span class="ActionScriptDefault_Text">initQuantTables</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">sf</span><span class="ActionScriptBracket/Brace">)</span>;
    <span class="ActionScriptBracket/Brace">}</span>

    <span class="ActionScriptReserved">public</span> <span class="ActionScriptfunction">function</span> <span class="ActionScriptReserved">get</span> <span class="ActionScriptDefault_Text">contentType</span><span class="ActionScriptBracket/Brace">()</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">String</span>
    <span class="ActionScriptBracket/Brace">{</span> <span class="ActionScriptReserved">return</span> <span class="ActionScriptDefault_Text">CONTENT_TYPE</span>; <span class="ActionScriptBracket/Brace">}</span>
    
    <span class="ActionScriptReserved">public</span> <span class="ActionScriptfunction">function</span> <span class="ActionScriptReserved">get</span> <span class="ActionScriptDefault_Text">PixelsPerIteration</span><span class="ActionScriptBracket/Brace">()</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">int</span>
    <span class="ActionScriptBracket/Brace">{</span> <span class="ActionScriptReserved">return</span> <span class="ActionScriptDefault_Text">PixelsPerIter</span>; <span class="ActionScriptBracket/Brace">}</span>
    
    <span class="ActionScriptReserved">public</span> <span class="ActionScriptfunction">function</span> <span class="ActionScriptReserved">set</span> <span class="ActionScriptDefault_Text">PixelsPerIteration</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">val</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">int</span><span class="ActionScriptBracket/Brace">)</span><span class="ActionScriptOperator">:</span><span class="ActionScriptReserved">void</span>
    <span class="ActionScriptBracket/Brace">{</span> <span class="ActionScriptDefault_Text">PixelsPerIter</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">val</span>; <span class="ActionScriptBracket/Brace">}</span>
    
    <span class="ActionScriptReserved">public</span> <span class="ActionScriptfunction">function</span> <span class="ActionScriptReserved">get</span> <span class="ActionScriptDefault_Text">ImageData</span><span class="ActionScriptBracket/Brace">()</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">ByteArray</span>
    <span class="ActionScriptBracket/Brace">{</span> <span class="ActionScriptReserved">return</span> <span class="ActionScriptDefault_Text">byteout</span>; <span class="ActionScriptBracket/Brace">}</span>

    <span class="ActionScriptReserved">public</span> <span class="ActionScriptfunction">function</span> <span class="ActionScriptDefault_Text">encodeByteArray</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">raw</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">ByteArray</span>, <span class="ActionScriptDefault_Text">width</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">int</span>, <span class="ActionScriptDefault_Text">height</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">int</span><span class="ActionScriptBracket/Brace">)</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">Boolean</span>
    <span class="ActionScriptBracket/Brace">{</span> <span class="ActionScriptReserved">return</span> <span class="ActionScriptDefault_Text">internalEncode</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">raw</span>, <span class="ActionScriptDefault_Text">width</span>, <span class="ActionScriptDefault_Text">height</span><span class="ActionScriptBracket/Brace">)</span>; <span class="ActionScriptBracket/Brace">}</span>

    <span class="ActionScriptReserved">public</span> <span class="ActionScriptfunction">function</span> <span class="ActionScriptDefault_Text">encode</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">image</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">BitmapData</span><span class="ActionScriptBracket/Brace">)</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">Boolean</span>
    <span class="ActionScriptBracket/Brace">{</span> <span class="ActionScriptReserved">return</span> <span class="ActionScriptDefault_Text">internalEncode</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">image</span>, <span class="ActionScriptDefault_Text">image</span>.<span class="ActionScriptDefault_Text">width</span>, <span class="ActionScriptDefault_Text">image</span>.<span class="ActionScriptDefault_Text">height</span><span class="ActionScriptBracket/Brace">)</span>; <span class="ActionScriptBracket/Brace">}</span>

    <span class="ActionScriptReserved">private</span> <span class="ActionScriptfunction">function</span> <span class="ActionScriptDefault_Text">internalEncode</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">newSource</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">Object</span>, <span class="ActionScriptDefault_Text">width</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">int</span>, <span class="ActionScriptDefault_Text">height</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">int</span><span class="ActionScriptBracket/Brace">)</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">Boolean</span>
    <span class="ActionScriptBracket/Brace">{</span>
      <span class="ActionScriptReserved">if</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">Working</span><span class="ActionScriptBracket/Brace">)</span>
        <span class="ActionScriptReserved">return</span> <span class="ActionScriptReserved">false</span>;
          
      <span class="ActionScriptDefault_Text">Working</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptReserved">true</span>;
      <span class="ActionScriptDefault_Text">Source</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">newSource</span>;
      <span class="ActionScriptDefault_Text">SrcWidth</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">width</span>;
      <span class="ActionScriptDefault_Text">SrcHeight</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">height</span>;
      <span class="ActionScriptDefault_Text">TotalSize</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">width</span><span class="ActionScriptOperator">*</span><span class="ActionScriptDefault_Text">height</span>;
      <span class="ActionScriptDefault_Text">PercentageInc</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">TotalSize</span><span class="ActionScriptOperator">/</span>100;
      <span class="ActionScriptDefault_Text">NextProgressAt</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">PercentageInc</span>;
      <span class="ActionScriptDefault_Text">CurrentTotalPos</span> <span class="ActionScriptOperator">=</span> 0;
        
      <span class="ActionScriptDefault_Text">setTimeout</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">StartEncode</span>, 10<span class="ActionScriptBracket/Brace">)</span>;
      <span class="ActionScriptReserved">return</span> <span class="ActionScriptReserved">true</span>;
    <span class="ActionScriptBracket/Brace">}</span>
    
    <span class="ActionScriptReserved">private</span> <span class="ActionScriptfunction">function</span> <span class="ActionScriptDefault_Text">StartEncode</span><span class="ActionScriptBracket/Brace">()</span><span class="ActionScriptOperator">:</span><span class="ActionScriptReserved">void</span>
    <span class="ActionScriptBracket/Brace">{</span>
      <span class="ActionScriptComment">// Initialize bit writer
</span>      <span class="ActionScriptDefault_Text">byteout</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptReserved">new</span> <span class="ActionScriptDefault_Text">ByteArray</span><span class="ActionScriptBracket/Brace">()</span>;
      <span class="ActionScriptDefault_Text">bytenew</span> <span class="ActionScriptOperator">=</span> 0;
      <span class="ActionScriptDefault_Text">bytepos</span> <span class="ActionScriptOperator">=</span> 7;

      <span class="ActionScriptComment">// Add JPEG headers
</span>      <span class="ActionScriptDefault_Text">writeWord</span><span class="ActionScriptBracket/Brace">(</span>0<span class="ActionScriptDefault_Text">xFFD8</span><span class="ActionScriptBracket/Brace">)</span>; <span class="ActionScriptComment">// SOI
</span>      <span class="ActionScriptDefault_Text">writeAPP0</span><span class="ActionScriptBracket/Brace">()</span>;
      <span class="ActionScriptDefault_Text">writeDQT</span><span class="ActionScriptBracket/Brace">()</span>;
      <span class="ActionScriptDefault_Text">writeSOF0</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">SrcWidth</span>, <span class="ActionScriptDefault_Text">SrcHeight</span><span class="ActionScriptBracket/Brace">)</span>;
      <span class="ActionScriptDefault_Text">writeDHT</span><span class="ActionScriptBracket/Brace">()</span>;
      <span class="ActionScriptDefault_Text">writeSOS</span><span class="ActionScriptBracket/Brace">()</span>;

      <span class="ActionScriptDefault_Text">DCY</span> <span class="ActionScriptOperator">=</span> 0;
      <span class="ActionScriptDefault_Text">DCV</span> <span class="ActionScriptOperator">=</span> 0;
      <span class="ActionScriptDefault_Text">DCU</span> <span class="ActionScriptOperator">=</span> 0;

      <span class="ActionScriptDefault_Text">bytenew</span> <span class="ActionScriptOperator">=</span> 0;
      <span class="ActionScriptDefault_Text">bytepos</span> <span class="ActionScriptOperator">=</span> 7;
      
      <span class="ActionScriptReserved">this</span>.<span class="ActionScriptDefault_Text">dispatchEvent</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptReserved">new</span> <span class="ActionScriptDefault_Text">ProgressEvent</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">ProgressEvent</span>.<span class="ActionScriptDefault_Text">PROGRESS</span>, <span class="ActionScriptReserved">false</span>, <span class="ActionScriptReserved">false</span>, 0, <span class="ActionScriptDefault_Text">TotalSize</span><span class="ActionScriptBracket/Brace">))</span>;
        
      <span class="ActionScriptDefault_Text">setTimeout</span><span class="ActionScriptBracket/Brace">(A</span><span class="ActionScriptDefault_Text">syncLoop</span>, 10, 0, 0<span class="ActionScriptBracket/Brace">)</span>;
    <span class="ActionScriptBracket/Brace">}</span>     
    
    <span class="ActionScriptReserved">private</span> <span class="ActionScriptfunction">function</span> <span class="ActionScriptDefault_Text">AsyncLoop</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">xpos</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">int</span>, <span class="ActionScriptDefault_Text">ypos</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">int</span><span class="ActionScriptBracket/Brace">)</span><span class="ActionScriptOperator">:</span><span class="ActionScriptReserved">void</span>
    <span class="ActionScriptBracket/Brace">{</span>
      <span class="ActionScriptReserved">for</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">i</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">int</span><span class="ActionScriptOperator">=</span>0; <span class="ActionScriptDefault_Text">i</span> <span class="ActionScriptOperator">&lt;</span> <span class="ActionScriptDefault_Text">PixelsPerIter</span>; <span class="ActionScriptDefault_Text">i</span><span class="ActionScriptOperator">++</span><span class="ActionScriptBracket/Brace">)</span>
      <span class="ActionScriptBracket/Brace">{</span> 
        <span class="ActionScriptDefault_Text">RGB2YUV</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">Source</span>, <span class="ActionScriptDefault_Text">xpos</span>, <span class="ActionScriptDefault_Text">ypos</span>, <span class="ActionScriptDefault_Text">SrcWidth</span>, <span class="ActionScriptDefault_Text">SrcHeight</span><span class="ActionScriptBracket/Brace">)</span>;
        <span class="ActionScriptDefault_Text">DCY</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">processDU</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">YDU</span>, <span class="ActionScriptDefault_Text">fdtbl_Y</span>, <span class="ActionScriptDefault_Text">DCY</span>, <span class="ActionScriptDefault_Text">YDC_HT</span>, <span class="ActionScriptDefault_Text">YAC_HT</span><span class="ActionScriptBracket/Brace">)</span>;
        <span class="ActionScriptDefault_Text">DCU</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">processDU</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">UDU</span>, <span class="ActionScriptDefault_Text">fdtbl_UV</span>, <span class="ActionScriptDefault_Text">DCU</span>, <span class="ActionScriptDefault_Text">UVDC_HT</span>, <span class="ActionScriptDefault_Text">UVAC_HT</span><span class="ActionScriptBracket/Brace">)</span>;
        <span class="ActionScriptDefault_Text">DCV</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">processDU</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">VDU</span>, <span class="ActionScriptDefault_Text">fdtbl_UV</span>, <span class="ActionScriptDefault_Text">DCV</span>, <span class="ActionScriptDefault_Text">UVDC_HT</span>, <span class="ActionScriptDefault_Text">UVAC_HT</span><span class="ActionScriptBracket/Brace">)</span>;
          
        <span class="ActionScriptDefault_Text">xpos</span> <span class="ActionScriptOperator">+=</span> 8;       
        <span class="ActionScriptReserved">if</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">xpos</span> <span class="ActionScriptOperator">&gt;=</span> <span class="ActionScriptDefault_Text">SrcWidth</span><span class="ActionScriptBracket/Brace">)</span>
        <span class="ActionScriptBracket/Brace">{</span>
          <span class="ActionScriptDefault_Text">xpos</span> <span class="ActionScriptOperator">=</span> 0;
          <span class="ActionScriptDefault_Text">ypos</span> <span class="ActionScriptOperator">+=</span> 8;
        <span class="ActionScriptBracket/Brace">}</span>
          
        <span class="ActionScriptReserved">if</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">ypos</span> <span class="ActionScriptOperator">&gt;=</span> <span class="ActionScriptDefault_Text">SrcHeight</span><span class="ActionScriptBracket/Brace">)</span>
        <span class="ActionScriptBracket/Brace">{</span>
          <span class="ActionScriptDefault_Text">setTimeout</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">FinishEncode</span>, 10<span class="ActionScriptBracket/Brace">)</span>;
          <span class="ActionScriptReserved">return</span>;
        <span class="ActionScriptBracket/Brace">}</span>
        
        <span class="ActionScriptDefault_Text">CurrentTotalPos</span> <span class="ActionScriptOperator">+=</span> 64;
        <span class="ActionScriptReserved">if</span><span class="ActionScriptBracket/Brace">(C</span><span class="ActionScriptDefault_Text">urrentTotalPos</span> <span class="ActionScriptOperator">&gt;=</span> <span class="ActionScriptDefault_Text">NextProgressAt</span><span class="ActionScriptBracket/Brace">)</span>
        <span class="ActionScriptBracket/Brace">{</span>
          <span class="ActionScriptReserved">this</span>.<span class="ActionScriptDefault_Text">dispatchEvent</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptReserved">new</span> <span class="ActionScriptDefault_Text">ProgressEvent</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">ProgressEvent</span>.<span class="ActionScriptDefault_Text">PROGRESS</span>, <span class="ActionScriptReserved">false</span>, <span class="ActionScriptReserved">false</span>, <span class="ActionScriptDefault_Text">CurrentTotalPos</span>, <span class="ActionScriptDefault_Text">TotalSize</span><span class="ActionScriptBracket/Brace">))</span>;
          <span class="ActionScriptDefault_Text">NextProgressAt</span> <span class="ActionScriptOperator">+=</span> <span class="ActionScriptDefault_Text">PercentageInc</span>;
        <span class="ActionScriptBracket/Brace">}</span>
      <span class="ActionScriptBracket/Brace">}</span>
      
      <span class="ActionScriptDefault_Text">setTimeout</span><span class="ActionScriptBracket/Brace">(A</span><span class="ActionScriptDefault_Text">syncLoop</span>, 10, <span class="ActionScriptDefault_Text">xpos</span>, <span class="ActionScriptDefault_Text">ypos</span><span class="ActionScriptBracket/Brace">)</span>;
    <span class="ActionScriptBracket/Brace">}</span>
    
    <span class="ActionScriptReserved">private</span> <span class="ActionScriptfunction">function</span> <span class="ActionScriptDefault_Text">FinishEncode</span><span class="ActionScriptBracket/Brace">()</span><span class="ActionScriptOperator">:</span><span class="ActionScriptReserved">void</span>
    <span class="ActionScriptBracket/Brace">{</span>
      <span class="ActionScriptComment">//EOI
</span>      <span class="ActionScriptReserved">if</span> <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">bytepos</span> <span class="ActionScriptOperator">&gt;=</span> 0<span class="ActionScriptBracket/Brace">)</span>
      <span class="ActionScriptBracket/Brace">{</span>
        <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">fillbits</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">BitString</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptReserved">new</span> <span class="ActionScriptDefault_Text">BitString</span><span class="ActionScriptBracket/Brace">()</span>;
        <span class="ActionScriptDefault_Text">fillbits</span>.<span class="ActionScriptDefault_Text">len</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">bytepos</span> <span class="ActionScriptOperator">+</span> 1;
        <span class="ActionScriptDefault_Text">fillbits</span>.<span class="ActionScriptDefault_Text">val</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptBracket/Brace">(</span>1 <span class="ActionScriptOperator">&lt;&lt;</span> <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">bytepos</span> <span class="ActionScriptOperator">+</span> 1<span class="ActionScriptBracket/Brace">))</span> <span class="ActionScriptOperator">-</span> 1;
        <span class="ActionScriptDefault_Text">writeBits</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">fillbits</span><span class="ActionScriptBracket/Brace">)</span>;
      <span class="ActionScriptBracket/Brace">}</span>
      <span class="ActionScriptDefault_Text">writeWord</span><span class="ActionScriptBracket/Brace">(</span>0<span class="ActionScriptDefault_Text">xFFD9</span><span class="ActionScriptBracket/Brace">)</span>;
      <span class="ActionScriptReserved">this</span>.<span class="ActionScriptDefault_Text">dispatchEvent</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptReserved">new</span> <span class="ActionScriptDefault_Text">ProgressEvent</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">ProgressEvent</span>.<span class="ActionScriptDefault_Text">PROGRESS</span>, <span class="ActionScriptReserved">false</span>, <span class="ActionScriptReserved">false</span>, <span class="ActionScriptDefault_Text">TotalSize</span>, <span class="ActionScriptDefault_Text">TotalSize</span><span class="ActionScriptBracket/Brace">))</span>;
      <span class="ActionScriptReserved">this</span>.<span class="ActionScriptDefault_Text">dispatchEvent</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptReserved">new</span> <span class="ActionScriptDefault_Text">JPEGAsyncCompleteEvent</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">byteout</span><span class="ActionScriptBracket/Brace">))</span>;
      <span class="ActionScriptDefault_Text">Working</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptReserved">false</span>;    
    <span class="ActionScriptBracket/Brace">}</span>
    
    <span class="ActionScriptReserved">private</span> <span class="ActionScriptfunction">function</span> <span class="ActionScriptDefault_Text">initQuantTables</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">sf</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">int</span><span class="ActionScriptBracket/Brace">)</span><span class="ActionScriptOperator">:</span><span class="ActionScriptReserved">void</span>
    <span class="ActionScriptBracket/Brace">{</span>
        <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">i</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">int</span> <span class="ActionScriptOperator">=</span> 0;
        <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">t</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">Number</span>;

        <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">YQT</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">Array</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptBracket/Brace">[</span>
            16, 11, 10, 16, 24, 40, 51, 61,
            12, 12, 14, 19, 26, 58, 60, 55,
            14, 13, 16, 24, 40, 57, 69, 56,
            14, 17, 22, 29, 51, 87, 80, 62,
            18, 22, 37, 56, 68,109,103, 77,
            24, 35, 55, 64, 81,104,113, 92,
            49, 64, 78, 87,103,121,120,101,
            72, 92, 95, 98,112,100,103, 99
        <span class="ActionScriptBracket/Brace">]</span>;
        <span class="ActionScriptReserved">for</span> <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">i</span> <span class="ActionScriptOperator">=</span> 0; <span class="ActionScriptDefault_Text">i</span> <span class="ActionScriptOperator">&lt;</span> 64; <span class="ActionScriptDefault_Text">i</span><span class="ActionScriptOperator">++</span><span class="ActionScriptBracket/Brace">)</span> <span class="ActionScriptBracket/Brace">{</span>
            <span class="ActionScriptDefault_Text">t</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">Math</span>.<span class="ActionScriptDefault_Text">floor</span><span class="ActionScriptBracket/Brace">((</span><span class="ActionScriptDefault_Text">YQT</span><span class="ActionScriptBracket/Brace">[</span><span class="ActionScriptDefault_Text">i</span><span class="ActionScriptBracket/Brace">]</span><span class="ActionScriptOperator">*</span><span class="ActionScriptDefault_Text">sf</span><span class="ActionScriptOperator">+</span>50<span class="ActionScriptBracket/Brace">)</span><span class="ActionScriptOperator">/</span>100<span class="ActionScriptBracket/Brace">)</span>;
            <span class="ActionScriptReserved">if</span> <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">t</span> <span class="ActionScriptOperator">&lt;</span> 1<span class="ActionScriptBracket/Brace">)</span> <span class="ActionScriptBracket/Brace">{</span>
                <span class="ActionScriptDefault_Text">t</span> <span class="ActionScriptOperator">=</span> 1;
            <span class="ActionScriptBracket/Brace">}</span> <span class="ActionScriptReserved">else</span> <span class="ActionScriptReserved">if</span> <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">t</span> <span class="ActionScriptOperator">&gt;</span> 255<span class="ActionScriptBracket/Brace">)</span> <span class="ActionScriptBracket/Brace">{</span>
                <span class="ActionScriptDefault_Text">t</span> <span class="ActionScriptOperator">=</span> 255;
            <span class="ActionScriptBracket/Brace">}</span>
            <span class="ActionScriptDefault_Text">YTable</span><span class="ActionScriptBracket/Brace">[</span><span class="ActionScriptDefault_Text">ZigZag</span><span class="ActionScriptBracket/Brace">[</span><span class="ActionScriptDefault_Text">i</span><span class="ActionScriptBracket/Brace">]]</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">t</span>;
        <span class="ActionScriptBracket/Brace">}</span>
        <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">UVQT</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">Array</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptBracket/Brace">[</span>
            17, 18, 24, 47, 99, 99, 99, 99,
            18, 21, 26, 66, 99, 99, 99, 99,
            24, 26, 56, 99, 99, 99, 99, 99,
            47, 66, 99, 99, 99, 99, 99, 99,
            99, 99, 99, 99, 99, 99, 99, 99,
            99, 99, 99, 99, 99, 99, 99, 99,
            99, 99, 99, 99, 99, 99, 99, 99,
            99, 99, 99, 99, 99, 99, 99, 99
        <span class="ActionScriptBracket/Brace">]</span>;
        <span class="ActionScriptReserved">for</span> <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">i</span> <span class="ActionScriptOperator">=</span> 0; <span class="ActionScriptDefault_Text">i</span> <span class="ActionScriptOperator">&lt;</span> 64; <span class="ActionScriptDefault_Text">i</span><span class="ActionScriptOperator">++</span><span class="ActionScriptBracket/Brace">)</span> <span class="ActionScriptBracket/Brace">{</span>
            <span class="ActionScriptDefault_Text">t</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">Math</span>.<span class="ActionScriptDefault_Text">floor</span><span class="ActionScriptBracket/Brace">((</span><span class="ActionScriptDefault_Text">UVQT</span><span class="ActionScriptBracket/Brace">[</span><span class="ActionScriptDefault_Text">i</span><span class="ActionScriptBracket/Brace">]</span><span class="ActionScriptOperator">*</span><span class="ActionScriptDefault_Text">sf</span><span class="ActionScriptOperator">+</span>50<span class="ActionScriptBracket/Brace">)</span><span class="ActionScriptOperator">/</span>100<span class="ActionScriptBracket/Brace">)</span>;
            <span class="ActionScriptReserved">if</span> <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">t</span> <span class="ActionScriptOperator">&lt;</span> 1<span class="ActionScriptBracket/Brace">)</span> <span class="ActionScriptBracket/Brace">{</span>
                <span class="ActionScriptDefault_Text">t</span> <span class="ActionScriptOperator">=</span> 1;
            <span class="ActionScriptBracket/Brace">}</span> <span class="ActionScriptReserved">else</span> <span class="ActionScriptReserved">if</span> <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">t</span> <span class="ActionScriptOperator">&gt;</span> 255<span class="ActionScriptBracket/Brace">)</span> <span class="ActionScriptBracket/Brace">{</span>
                <span class="ActionScriptDefault_Text">t</span> <span class="ActionScriptOperator">=</span> 255;
            <span class="ActionScriptBracket/Brace">}</span>
            <span class="ActionScriptDefault_Text">UVTable</span><span class="ActionScriptBracket/Brace">[</span><span class="ActionScriptDefault_Text">ZigZag</span><span class="ActionScriptBracket/Brace">[</span><span class="ActionScriptDefault_Text">i</span><span class="ActionScriptBracket/Brace">]]</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">t</span>;
        <span class="ActionScriptBracket/Brace">}</span>
        <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">aasf</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">Array</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptBracket/Brace">[</span>
            1.0, 1.387039845, 1.306562965, 1.175875602,
            1.0, 0.785694958, 0.541196100, 0.275899379
        <span class="ActionScriptBracket/Brace">]</span>;

        <span class="ActionScriptDefault_Text">i</span> <span class="ActionScriptOperator">=</span> 0;
        <span class="ActionScriptReserved">for</span> <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">row</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">int</span> <span class="ActionScriptOperator">=</span> 0; <span class="ActionScriptDefault_Text">row</span> <span class="ActionScriptOperator">&lt;</span> 8; <span class="ActionScriptDefault_Text">row</span><span class="ActionScriptOperator">++</span><span class="ActionScriptBracket/Brace">)</span>
        <span class="ActionScriptBracket/Brace">{</span>
            <span class="ActionScriptReserved">for</span> <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">col</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">int</span> <span class="ActionScriptOperator">=</span> 0; <span class="ActionScriptDefault_Text">col</span> <span class="ActionScriptOperator">&lt;</span> 8; <span class="ActionScriptDefault_Text">col</span><span class="ActionScriptOperator">++</span><span class="ActionScriptBracket/Brace">)</span>
            <span class="ActionScriptBracket/Brace">{</span>
                <span class="ActionScriptDefault_Text">fdtbl_Y</span><span class="ActionScriptBracket/Brace">[</span><span class="ActionScriptDefault_Text">i</span><span class="ActionScriptBracket/Brace">]</span>  <span class="ActionScriptOperator">=</span> <span class="ActionScriptBracket/Brace">(</span>1.0 <span class="ActionScriptOperator">/</span> <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">YTable</span> <span class="ActionScriptBracket/Brace">[</span><span class="ActionScriptDefault_Text">ZigZag</span><span class="ActionScriptBracket/Brace">[</span><span class="ActionScriptDefault_Text">i</span><span class="ActionScriptBracket/Brace">]]</span> <span class="ActionScriptOperator">*</span> <span class="ActionScriptDefault_Text">aasf</span><span class="ActionScriptBracket/Brace">[</span><span class="ActionScriptDefault_Text">row</span><span class="ActionScriptBracket/Brace">]</span> <span class="ActionScriptOperator">*</span> <span class="ActionScriptDefault_Text">aasf</span><span class="ActionScriptBracket/Brace">[</span><span class="ActionScriptDefault_Text">col</span><span class="ActionScriptBracket/Brace">]</span> <span class="ActionScriptOperator">*</span> 8.0<span class="ActionScriptBracket/Brace">))</span>;
                <span class="ActionScriptDefault_Text">fdtbl_UV</span><span class="ActionScriptBracket/Brace">[</span><span class="ActionScriptDefault_Text">i</span><span class="ActionScriptBracket/Brace">]</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptBracket/Brace">(</span>1.0 <span class="ActionScriptOperator">/</span> <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">UVTable</span><span class="ActionScriptBracket/Brace">[</span><span class="ActionScriptDefault_Text">ZigZag</span><span class="ActionScriptBracket/Brace">[</span><span class="ActionScriptDefault_Text">i</span><span class="ActionScriptBracket/Brace">]]</span> <span class="ActionScriptOperator">*</span> <span class="ActionScriptDefault_Text">aasf</span><span class="ActionScriptBracket/Brace">[</span><span class="ActionScriptDefault_Text">row</span><span class="ActionScriptBracket/Brace">]</span> <span class="ActionScriptOperator">*</span> <span class="ActionScriptDefault_Text">aasf</span><span class="ActionScriptBracket/Brace">[</span><span class="ActionScriptDefault_Text">col</span><span class="ActionScriptBracket/Brace">]</span> <span class="ActionScriptOperator">*</span> 8.0<span class="ActionScriptBracket/Brace">))</span>;
                <span class="ActionScriptDefault_Text">i</span><span class="ActionScriptOperator">++</span>;
            <span class="ActionScriptBracket/Brace">}</span>
        <span class="ActionScriptBracket/Brace">}</span>
    <span class="ActionScriptBracket/Brace">}</span>

 
    <span class="ActionScriptReserved">private</span> <span class="ActionScriptfunction">function</span> <span class="ActionScriptDefault_Text">computeHuffmanTbl</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">nrcodes</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">Array</span>, <span class="ActionScriptDefault_Text">std_table</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">Array</span><span class="ActionScriptBracket/Brace">)</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">Array</span>
    <span class="ActionScriptBracket/Brace">{</span>
        <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">codevalue</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">int</span> <span class="ActionScriptOperator">=</span> 0;
        <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">pos_in_table</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">int</span> <span class="ActionScriptOperator">=</span> 0;
        <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">HT</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">Array</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptReserved">new</span> <span class="ActionScriptDefault_Text">Array</span><span class="ActionScriptBracket/Brace">()</span>;
        <span class="ActionScriptReserved">for</span> <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">k</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">int</span> <span class="ActionScriptOperator">=</span> 1; <span class="ActionScriptDefault_Text">k</span> <span class="ActionScriptOperator">&lt;=</span> 16; <span class="ActionScriptDefault_Text">k</span><span class="ActionScriptOperator">++</span><span class="ActionScriptBracket/Brace">)</span>
        <span class="ActionScriptBracket/Brace">{</span>
            <span class="ActionScriptReserved">for</span> <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">j</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">int</span> <span class="ActionScriptOperator">=</span> 1; <span class="ActionScriptDefault_Text">j</span> <span class="ActionScriptOperator">&lt;=</span> <span class="ActionScriptDefault_Text">nrcodes</span><span class="ActionScriptBracket/Brace">[</span><span class="ActionScriptDefault_Text">k</span><span class="ActionScriptBracket/Brace">]</span>; <span class="ActionScriptDefault_Text">j</span><span class="ActionScriptOperator">++</span><span class="ActionScriptBracket/Brace">)</span>
            <span class="ActionScriptBracket/Brace">{</span>
                <span class="ActionScriptDefault_Text">HT</span><span class="ActionScriptBracket/Brace">[</span><span class="ActionScriptDefault_Text">std_table</span><span class="ActionScriptBracket/Brace">[</span><span class="ActionScriptDefault_Text">pos_in_table</span><span class="ActionScriptBracket/Brace">]]</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptReserved">new</span> <span class="ActionScriptDefault_Text">BitString</span><span class="ActionScriptBracket/Brace">()</span>;
                <span class="ActionScriptDefault_Text">HT</span><span class="ActionScriptBracket/Brace">[</span><span class="ActionScriptDefault_Text">std_table</span><span class="ActionScriptBracket/Brace">[</span><span class="ActionScriptDefault_Text">pos_in_table</span><span class="ActionScriptBracket/Brace">]]</span>.<span class="ActionScriptDefault_Text">val</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">codevalue</span>;
                <span class="ActionScriptDefault_Text">HT</span><span class="ActionScriptBracket/Brace">[</span><span class="ActionScriptDefault_Text">std_table</span><span class="ActionScriptBracket/Brace">[</span><span class="ActionScriptDefault_Text">pos_in_table</span><span class="ActionScriptBracket/Brace">]]</span>.<span class="ActionScriptDefault_Text">len</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">k</span>;
                <span class="ActionScriptDefault_Text">pos_in_table</span><span class="ActionScriptOperator">++</span>;
                <span class="ActionScriptDefault_Text">codevalue</span><span class="ActionScriptOperator">++</span>;
            <span class="ActionScriptBracket/Brace">}</span>
            <span class="ActionScriptDefault_Text">codevalue</span> <span class="ActionScriptOperator">*=</span> 2;
        <span class="ActionScriptBracket/Brace">}</span>
        <span class="ActionScriptReserved">return</span> <span class="ActionScriptDefault_Text">HT</span>;
    <span class="ActionScriptBracket/Brace">}</span>

    <span class="ActionScriptReserved">private</span> <span class="ActionScriptfunction">function</span> <span class="ActionScriptDefault_Text">initHuffmanTbl</span><span class="ActionScriptBracket/Brace">()</span><span class="ActionScriptOperator">:</span><span class="ActionScriptReserved">void</span>
    <span class="ActionScriptBracket/Brace">{</span>
        <span class="ActionScriptDefault_Text">YDC_HT</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">computeHuffmanTbl</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">std_dc_luminance_nrcodes</span>,<span class="ActionScriptDefault_Text">std_dc_luminance_values</span><span class="ActionScriptBracket/Brace">)</span>;
        <span class="ActionScriptDefault_Text">UVDC_HT</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">computeHuffmanTbl</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">std_dc_chrominance_nrcodes</span>,<span class="ActionScriptDefault_Text">std_dc_chrominance_values</span><span class="ActionScriptBracket/Brace">)</span>;
        <span class="ActionScriptDefault_Text">YAC_HT</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">computeHuffmanTbl</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">std_ac_luminance_nrcodes</span>,<span class="ActionScriptDefault_Text">std_ac_luminance_values</span><span class="ActionScriptBracket/Brace">)</span>;
        <span class="ActionScriptDefault_Text">UVAC_HT</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">computeHuffmanTbl</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">std_ac_chrominance_nrcodes</span>,<span class="ActionScriptDefault_Text">std_ac_chrominance_values</span><span class="ActionScriptBracket/Brace">)</span>;
    <span class="ActionScriptBracket/Brace">}</span>

    <span class="ActionScriptReserved">private</span> <span class="ActionScriptfunction">function</span> <span class="ActionScriptDefault_Text">initCategoryNumber</span><span class="ActionScriptBracket/Brace">()</span><span class="ActionScriptOperator">:</span><span class="ActionScriptReserved">void</span>
    <span class="ActionScriptBracket/Brace">{</span>
        <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">nr</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">int</span>;
        <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">nrlower</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">int</span> <span class="ActionScriptOperator">=</span> 1;
        <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">nrupper</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">int</span> <span class="ActionScriptOperator">=</span> 2;
        <span class="ActionScriptReserved">for</span> <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">cat</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">int</span> <span class="ActionScriptOperator">=</span> 1; <span class="ActionScriptDefault_Text">cat</span> <span class="ActionScriptOperator">&lt;=</span> 15; <span class="ActionScriptDefault_Text">cat</span><span class="ActionScriptOperator">++</span><span class="ActionScriptBracket/Brace">)</span>
        <span class="ActionScriptBracket/Brace">{</span>
            <span class="ActionScriptComment">//Positive numbers
</span>            <span class="ActionScriptReserved">for</span> <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">nr</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">nrlower</span>; <span class="ActionScriptDefault_Text">nr</span> <span class="ActionScriptOperator">&lt;</span> <span class="ActionScriptDefault_Text">nrupper</span>; <span class="ActionScriptDefault_Text">nr</span><span class="ActionScriptOperator">++</span><span class="ActionScriptBracket/Brace">)</span>
            <span class="ActionScriptBracket/Brace">{</span>
                <span class="ActionScriptDefault_Text">category</span><span class="ActionScriptBracket/Brace">[</span>32767<span class="ActionScriptOperator">+</span><span class="ActionScriptDefault_Text">nr</span><span class="ActionScriptBracket/Brace">]</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">cat</span>;
                <span class="ActionScriptDefault_Text">bitcode</span><span class="ActionScriptBracket/Brace">[</span>32767<span class="ActionScriptOperator">+</span><span class="ActionScriptDefault_Text">nr</span><span class="ActionScriptBracket/Brace">]</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptReserved">new</span> <span class="ActionScriptDefault_Text">BitString</span><span class="ActionScriptBracket/Brace">()</span>;
                <span class="ActionScriptDefault_Text">bitcode</span><span class="ActionScriptBracket/Brace">[</span>32767<span class="ActionScriptOperator">+</span><span class="ActionScriptDefault_Text">nr</span><span class="ActionScriptBracket/Brace">]</span>.<span class="ActionScriptDefault_Text">len</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">cat</span>;
                <span class="ActionScriptDefault_Text">bitcode</span><span class="ActionScriptBracket/Brace">[</span>32767<span class="ActionScriptOperator">+</span><span class="ActionScriptDefault_Text">nr</span><span class="ActionScriptBracket/Brace">]</span>.<span class="ActionScriptDefault_Text">val</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">nr</span>;
            <span class="ActionScriptBracket/Brace">}</span>

            <span class="ActionScriptComment">//Negative numbers
</span>            <span class="ActionScriptReserved">for</span> <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">nr</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptOperator">-</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">nrupper</span><span class="ActionScriptOperator">-</span>1<span class="ActionScriptBracket/Brace">)</span>; <span class="ActionScriptDefault_Text">nr</span> <span class="ActionScriptOperator">&lt;=</span> <span class="ActionScriptOperator">-</span><span class="ActionScriptDefault_Text">nrlower</span>; <span class="ActionScriptDefault_Text">nr</span><span class="ActionScriptOperator">++</span><span class="ActionScriptBracket/Brace">)</span>
            <span class="ActionScriptBracket/Brace">{</span>
                <span class="ActionScriptDefault_Text">category</span><span class="ActionScriptBracket/Brace">[</span>32767<span class="ActionScriptOperator">+</span><span class="ActionScriptDefault_Text">nr</span><span class="ActionScriptBracket/Brace">]</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">cat</span>;
                <span class="ActionScriptDefault_Text">bitcode</span><span class="ActionScriptBracket/Brace">[</span>32767<span class="ActionScriptOperator">+</span><span class="ActionScriptDefault_Text">nr</span><span class="ActionScriptBracket/Brace">]</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptReserved">new</span> <span class="ActionScriptDefault_Text">BitString</span><span class="ActionScriptBracket/Brace">()</span>;
                <span class="ActionScriptDefault_Text">bitcode</span><span class="ActionScriptBracket/Brace">[</span>32767<span class="ActionScriptOperator">+</span><span class="ActionScriptDefault_Text">nr</span><span class="ActionScriptBracket/Brace">]</span>.<span class="ActionScriptDefault_Text">len</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">cat</span>;
                <span class="ActionScriptDefault_Text">bitcode</span><span class="ActionScriptBracket/Brace">[</span>32767<span class="ActionScriptOperator">+</span><span class="ActionScriptDefault_Text">nr</span><span class="ActionScriptBracket/Brace">]</span>.<span class="ActionScriptDefault_Text">val</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">nrupper</span><span class="ActionScriptOperator">-</span>1<span class="ActionScriptOperator">+</span><span class="ActionScriptDefault_Text">nr</span>;
            <span class="ActionScriptBracket/Brace">}</span>
            <span class="ActionScriptDefault_Text">nrlower</span> <span class="ActionScriptOperator">&lt;&lt;=</span> 1;
            <span class="ActionScriptDefault_Text">nrupper</span> <span class="ActionScriptOperator">&lt;&lt;=</span> 1;
        <span class="ActionScriptBracket/Brace">}</span>
    <span class="ActionScriptBracket/Brace">}</span>

    <span class="ActionScriptComment">// IO functions
</span>    <span class="ActionScriptReserved">private</span> <span class="ActionScriptfunction">function</span> <span class="ActionScriptDefault_Text">writeBits</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">bs</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">BitString</span><span class="ActionScriptBracket/Brace">)</span><span class="ActionScriptOperator">:</span><span class="ActionScriptReserved">void</span>
    <span class="ActionScriptBracket/Brace">{</span>
        <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">value</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">int</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">bs</span>.<span class="ActionScriptDefault_Text">val</span>;
        <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">posval</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">int</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">bs</span>.<span class="ActionScriptDefault_Text">len</span><span class="ActionScriptOperator">-</span>1;
        <span class="ActionScriptReserved">while</span> <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">posval</span> <span class="ActionScriptOperator">&gt;=</span> 0<span class="ActionScriptBracket/Brace">)</span>
        <span class="ActionScriptBracket/Brace">{</span>
            <span class="ActionScriptReserved">if</span> <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">value</span> <span class="ActionScriptOperator">&amp;</span> <span class="ActionScriptDefault_Text">uint</span><span class="ActionScriptBracket/Brace">(</span>1 <span class="ActionScriptOperator">&lt;&lt;</span> <span class="ActionScriptDefault_Text">posval</span><span class="ActionScriptBracket/Brace">)</span> <span class="ActionScriptBracket/Brace">)</span>
            <span class="ActionScriptBracket/Brace">{</span>
                <span class="ActionScriptDefault_Text">bytenew</span> <span class="ActionScriptOperator">|=</span> <span class="ActionScriptDefault_Text">uint</span><span class="ActionScriptBracket/Brace">(</span>1 <span class="ActionScriptOperator">&lt;&lt;</span> <span class="ActionScriptDefault_Text">bytepos</span><span class="ActionScriptBracket/Brace">)</span>;
            <span class="ActionScriptBracket/Brace">}</span>
            <span class="ActionScriptDefault_Text">posval</span><span class="ActionScriptOperator">--</span>;
            <span class="ActionScriptDefault_Text">bytepos</span><span class="ActionScriptOperator">--</span>;
            <span class="ActionScriptReserved">if</span> <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">bytepos</span> <span class="ActionScriptOperator">&lt;</span> 0<span class="ActionScriptBracket/Brace">)</span>
            <span class="ActionScriptBracket/Brace">{</span>
                <span class="ActionScriptReserved">if</span> <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">bytenew</span> <span class="ActionScriptOperator">==</span> 0<span class="ActionScriptDefault_Text">xFF</span><span class="ActionScriptBracket/Brace">)</span>
                <span class="ActionScriptBracket/Brace">{</span>
                    <span class="ActionScriptDefault_Text">writeByte</span><span class="ActionScriptBracket/Brace">(</span>0<span class="ActionScriptDefault_Text">xFF</span><span class="ActionScriptBracket/Brace">)</span>;
                    <span class="ActionScriptDefault_Text">writeByte</span><span class="ActionScriptBracket/Brace">(</span>0<span class="ActionScriptBracket/Brace">)</span>;
                <span class="ActionScriptBracket/Brace">}</span>
                <span class="ActionScriptReserved">else</span>
                <span class="ActionScriptBracket/Brace">{</span>
                    <span class="ActionScriptDefault_Text">writeByte</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">bytenew</span><span class="ActionScriptBracket/Brace">)</span>;
                <span class="ActionScriptBracket/Brace">}</span>
                <span class="ActionScriptDefault_Text">bytepos</span><span class="ActionScriptOperator">=</span>7;
                <span class="ActionScriptDefault_Text">bytenew</span><span class="ActionScriptOperator">=</span>0;
            <span class="ActionScriptBracket/Brace">}</span>
        <span class="ActionScriptBracket/Brace">}</span>
    <span class="ActionScriptBracket/Brace">}</span>

    <span class="ActionScriptReserved">private</span> <span class="ActionScriptfunction">function</span> <span class="ActionScriptDefault_Text">writeByte</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">value</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">int</span><span class="ActionScriptBracket/Brace">)</span><span class="ActionScriptOperator">:</span><span class="ActionScriptReserved">void</span>
    <span class="ActionScriptBracket/Brace">{</span>
        <span class="ActionScriptDefault_Text">byteout</span>.<span class="ActionScriptDefault_Text">writeByte</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">value</span><span class="ActionScriptBracket/Brace">)</span>;
    <span class="ActionScriptBracket/Brace">}</span>

    <span class="ActionScriptReserved">private</span> <span class="ActionScriptfunction">function</span> <span class="ActionScriptDefault_Text">writeWord</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">value</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">int</span><span class="ActionScriptBracket/Brace">)</span><span class="ActionScriptOperator">:</span><span class="ActionScriptReserved">void</span>
    <span class="ActionScriptBracket/Brace">{</span>
        <span class="ActionScriptDefault_Text">writeByte</span><span class="ActionScriptBracket/Brace">((</span><span class="ActionScriptDefault_Text">value</span><span class="ActionScriptOperator">&gt;&gt;</span>8<span class="ActionScriptBracket/Brace">)</span><span class="ActionScriptOperator">&amp;</span>0<span class="ActionScriptDefault_Text">xFF</span><span class="ActionScriptBracket/Brace">)</span>;
        <span class="ActionScriptDefault_Text">writeByte</span><span class="ActionScriptBracket/Brace">((</span><span class="ActionScriptDefault_Text">value</span>   <span class="ActionScriptBracket/Brace">)</span><span class="ActionScriptOperator">&amp;</span>0<span class="ActionScriptDefault_Text">xFF</span><span class="ActionScriptBracket/Brace">)</span>;
    <span class="ActionScriptBracket/Brace">}</span>

    <span class="ActionScriptComment">// DCT &amp; quantization core
</span>
    <span class="ActionScriptReserved">private</span> <span class="ActionScriptfunction">function</span> <span class="ActionScriptDefault_Text">fDCTQuant</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">data</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">Array</span>, <span class="ActionScriptDefault_Text">fdtbl</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">Array</span><span class="ActionScriptBracket/Brace">)</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">Array</span>
    <span class="ActionScriptBracket/Brace">{</span>
        <span class="ActionScriptComment">/* Pass 1: process rows. */</span>
        <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">dataOff</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">int</span><span class="ActionScriptOperator">=</span>0;
        <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">i</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">int</span>;
        <span class="ActionScriptReserved">for</span> <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">i</span> <span class="ActionScriptOperator">=</span> 0; <span class="ActionScriptDefault_Text">i</span> <span class="ActionScriptOperator">&lt;</span> 8; <span class="ActionScriptDefault_Text">i</span><span class="ActionScriptOperator">++</span><span class="ActionScriptBracket/Brace">)</span>
        <span class="ActionScriptBracket/Brace">{</span>
            <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">tmp0</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">Number</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">data</span><span class="ActionScriptBracket/Brace">[</span><span class="ActionScriptDefault_Text">dataOff</span><span class="ActionScriptOperator">+</span>0<span class="ActionScriptBracket/Brace">]</span> <span class="ActionScriptOperator">+</span> <span class="ActionScriptDefault_Text">data</span><span class="ActionScriptBracket/Brace">[</span><span class="ActionScriptDefault_Text">dataOff</span><span class="ActionScriptOperator">+</span>7<span class="ActionScriptBracket/Brace">]</span>;
            <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">tmp7</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">Number</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">data</span><span class="ActionScriptBracket/Brace">[</span><span class="ActionScriptDefault_Text">dataOff</span><span class="ActionScriptOperator">+</span>0<span class="ActionScriptBracket/Brace">]</span> <span class="ActionScriptOperator">-</span> <span class="ActionScriptDefault_Text">data</span><span class="ActionScriptBracket/Brace">[</span><span class="ActionScriptDefault_Text">dataOff</span><span class="ActionScriptOperator">+</span>7<span class="ActionScriptBracket/Brace">]</span>;
            <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">tmp1</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">Number</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">data</span><span class="ActionScriptBracket/Brace">[</span><span class="ActionScriptDefault_Text">dataOff</span><span class="ActionScriptOperator">+</span>1<span class="ActionScriptBracket/Brace">]</span> <span class="ActionScriptOperator">+</span> <span class="ActionScriptDefault_Text">data</span><span class="ActionScriptBracket/Brace">[</span><span class="ActionScriptDefault_Text">dataOff</span><span class="ActionScriptOperator">+</span>6<span class="ActionScriptBracket/Brace">]</span>;
            <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">tmp6</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">Number</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">data</span><span class="ActionScriptBracket/Brace">[</span><span class="ActionScriptDefault_Text">dataOff</span><span class="ActionScriptOperator">+</span>1<span class="ActionScriptBracket/Brace">]</span> <span class="ActionScriptOperator">-</span> <span class="ActionScriptDefault_Text">data</span><span class="ActionScriptBracket/Brace">[</span><span class="ActionScriptDefault_Text">dataOff</span><span class="ActionScriptOperator">+</span>6<span class="ActionScriptBracket/Brace">]</span>;
            <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">tmp2</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">Number</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">data</span><span class="ActionScriptBracket/Brace">[</span><span class="ActionScriptDefault_Text">dataOff</span><span class="ActionScriptOperator">+</span>2<span class="ActionScriptBracket/Brace">]</span> <span class="ActionScriptOperator">+</span> <span class="ActionScriptDefault_Text">data</span><span class="ActionScriptBracket/Brace">[</span><span class="ActionScriptDefault_Text">dataOff</span><span class="ActionScriptOperator">+</span>5<span class="ActionScriptBracket/Brace">]</span>;
            <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">tmp5</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">Number</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">data</span><span class="ActionScriptBracket/Brace">[</span><span class="ActionScriptDefault_Text">dataOff</span><span class="ActionScriptOperator">+</span>2<span class="ActionScriptBracket/Brace">]</span> <span class="ActionScriptOperator">-</span> <span class="ActionScriptDefault_Text">data</span><span class="ActionScriptBracket/Brace">[</span><span class="ActionScriptDefault_Text">dataOff</span><span class="ActionScriptOperator">+</span>5<span class="ActionScriptBracket/Brace">]</span>;
            <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">tmp3</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">Number</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">data</span><span class="ActionScriptBracket/Brace">[</span><span class="ActionScriptDefault_Text">dataOff</span><span class="ActionScriptOperator">+</span>3<span class="ActionScriptBracket/Brace">]</span> <span class="ActionScriptOperator">+</span> <span class="ActionScriptDefault_Text">data</span><span class="ActionScriptBracket/Brace">[</span><span class="ActionScriptDefault_Text">dataOff</span><span class="ActionScriptOperator">+</span>4<span class="ActionScriptBracket/Brace">]</span>;
            <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">tmp4</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">Number</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">data</span><span class="ActionScriptBracket/Brace">[</span><span class="ActionScriptDefault_Text">dataOff</span><span class="ActionScriptOperator">+</span>3<span class="ActionScriptBracket/Brace">]</span> <span class="ActionScriptOperator">-</span> <span class="ActionScriptDefault_Text">data</span><span class="ActionScriptBracket/Brace">[</span><span class="ActionScriptDefault_Text">dataOff</span><span class="ActionScriptOperator">+</span>4<span class="ActionScriptBracket/Brace">]</span>;

            <span class="ActionScriptComment">/* Even part */</span>
            <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">tmp10</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">Number</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">tmp0</span> <span class="ActionScriptOperator">+</span> <span class="ActionScriptDefault_Text">tmp3</span>;    <span class="ActionScriptComment">/* phase 2 */</span>
            <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">tmp13</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">Number</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">tmp0</span> <span class="ActionScriptOperator">-</span> <span class="ActionScriptDefault_Text">tmp3</span>;
            <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">tmp11</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">Number</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">tmp1</span> <span class="ActionScriptOperator">+</span> <span class="ActionScriptDefault_Text">tmp2</span>;
            <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">tmp12</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">Number</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">tmp1</span> <span class="ActionScriptOperator">-</span> <span class="ActionScriptDefault_Text">tmp2</span>;

            <span class="ActionScriptDefault_Text">data</span><span class="ActionScriptBracket/Brace">[</span><span class="ActionScriptDefault_Text">dataOff</span><span class="ActionScriptOperator">+</span>0<span class="ActionScriptBracket/Brace">]</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">tmp10</span> <span class="ActionScriptOperator">+</span> <span class="ActionScriptDefault_Text">tmp11</span>; <span class="ActionScriptComment">/* phase 3 */</span>
            <span class="ActionScriptDefault_Text">data</span><span class="ActionScriptBracket/Brace">[</span><span class="ActionScriptDefault_Text">dataOff</span><span class="ActionScriptOperator">+</span>4<span class="ActionScriptBracket/Brace">]</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">tmp10</span> <span class="ActionScriptOperator">-</span> <span class="ActionScriptDefault_Text">tmp11</span>;

            <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">z1</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">Number</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">tmp12</span> <span class="ActionScriptOperator">+</span> <span class="ActionScriptDefault_Text">tmp13</span><span class="ActionScriptBracket/Brace">)</span> <span class="ActionScriptOperator">*</span> 0.707106781; <span class="ActionScriptComment">/* c4 */</span>
            <span class="ActionScriptDefault_Text">data</span><span class="ActionScriptBracket/Brace">[</span><span class="ActionScriptDefault_Text">dataOff</span><span class="ActionScriptOperator">+</span>2<span class="ActionScriptBracket/Brace">]</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">tmp13</span> <span class="ActionScriptOperator">+</span> <span class="ActionScriptDefault_Text">z1</span>; <span class="ActionScriptComment">/* phase 5 */</span>
            <span class="ActionScriptDefault_Text">data</span><span class="ActionScriptBracket/Brace">[</span><span class="ActionScriptDefault_Text">dataOff</span><span class="ActionScriptOperator">+</span>6<span class="ActionScriptBracket/Brace">]</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">tmp13</span> <span class="ActionScriptOperator">-</span> <span class="ActionScriptDefault_Text">z1</span>;

            <span class="ActionScriptComment">/* Odd part */</span>
            <span class="ActionScriptDefault_Text">tmp10</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">tmp4</span> <span class="ActionScriptOperator">+</span> <span class="ActionScriptDefault_Text">tmp5</span>; <span class="ActionScriptComment">/* phase 2 */</span>
            <span class="ActionScriptDefault_Text">tmp11</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">tmp5</span> <span class="ActionScriptOperator">+</span> <span class="ActionScriptDefault_Text">tmp6</span>;
            <span class="ActionScriptDefault_Text">tmp12</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">tmp6</span> <span class="ActionScriptOperator">+</span> <span class="ActionScriptDefault_Text">tmp7</span>;

            <span class="ActionScriptComment">/* The rotator is modified from fig 4-8 to avoid extra negations. */</span>
            <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">z5</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">Number</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">tmp10</span> <span class="ActionScriptOperator">-</span> <span class="ActionScriptDefault_Text">tmp12</span><span class="ActionScriptBracket/Brace">)</span> <span class="ActionScriptOperator">*</span> 0.382683433; <span class="ActionScriptComment">/* c6 */</span>
            <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">z2</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">Number</span> <span class="ActionScriptOperator">=</span> 0.541196100 <span class="ActionScriptOperator">*</span> <span class="ActionScriptDefault_Text">tmp10</span> <span class="ActionScriptOperator">+</span> <span class="ActionScriptDefault_Text">z5</span>; <span class="ActionScriptComment">/* c2-c6 */</span>
            <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">z4</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">Number</span> <span class="ActionScriptOperator">=</span> 1.306562965 <span class="ActionScriptOperator">*</span> <span class="ActionScriptDefault_Text">tmp12</span> <span class="ActionScriptOperator">+</span> <span class="ActionScriptDefault_Text">z5</span>; <span class="ActionScriptComment">/* c2+c6 */</span>
            <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">z3</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">Number</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">tmp11</span> <span class="ActionScriptOperator">*</span> 0.707106781; <span class="ActionScriptComment">/* c4 */</span>

            <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">z11</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">Number</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">tmp7</span> <span class="ActionScriptOperator">+</span> <span class="ActionScriptDefault_Text">z3</span>;    <span class="ActionScriptComment">/* phase 5 */</span>
            <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">z13</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">Number</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">tmp7</span> <span class="ActionScriptOperator">-</span> <span class="ActionScriptDefault_Text">z3</span>;

            <span class="ActionScriptDefault_Text">data</span><span class="ActionScriptBracket/Brace">[</span><span class="ActionScriptDefault_Text">dataOff</span><span class="ActionScriptOperator">+</span>5<span class="ActionScriptBracket/Brace">]</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">z13</span> <span class="ActionScriptOperator">+</span> <span class="ActionScriptDefault_Text">z2</span>;    <span class="ActionScriptComment">/* phase 6 */</span>
            <span class="ActionScriptDefault_Text">data</span><span class="ActionScriptBracket/Brace">[</span><span class="ActionScriptDefault_Text">dataOff</span><span class="ActionScriptOperator">+</span>3<span class="ActionScriptBracket/Brace">]</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">z13</span> <span class="ActionScriptOperator">-</span> <span class="ActionScriptDefault_Text">z2</span>;
            <span class="ActionScriptDefault_Text">data</span><span class="ActionScriptBracket/Brace">[</span><span class="ActionScriptDefault_Text">dataOff</span><span class="ActionScriptOperator">+</span>1<span class="ActionScriptBracket/Brace">]</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">z11</span> <span class="ActionScriptOperator">+</span> <span class="ActionScriptDefault_Text">z4</span>;
            <span class="ActionScriptDefault_Text">data</span><span class="ActionScriptBracket/Brace">[</span><span class="ActionScriptDefault_Text">dataOff</span><span class="ActionScriptOperator">+</span>7<span class="ActionScriptBracket/Brace">]</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">z11</span> <span class="ActionScriptOperator">-</span> <span class="ActionScriptDefault_Text">z4</span>;

            <span class="ActionScriptDefault_Text">dataOff</span> <span class="ActionScriptOperator">+=</span> 8; <span class="ActionScriptComment">/* advance pointer to next row */</span>
        <span class="ActionScriptBracket/Brace">}</span>

        <span class="ActionScriptComment">/* Pass 2: process columns. */</span>
        <span class="ActionScriptDefault_Text">dataOff</span> <span class="ActionScriptOperator">=</span> 0;
        <span class="ActionScriptReserved">for</span> <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">i</span> <span class="ActionScriptOperator">=</span> 0; <span class="ActionScriptDefault_Text">i</span> <span class="ActionScriptOperator">&lt;</span> 8; <span class="ActionScriptDefault_Text">i</span><span class="ActionScriptOperator">++</span><span class="ActionScriptBracket/Brace">)</span>
        <span class="ActionScriptBracket/Brace">{</span>
            <span class="ActionScriptDefault_Text">tmp0</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">data</span><span class="ActionScriptBracket/Brace">[</span><span class="ActionScriptDefault_Text">dataOff</span><span class="ActionScriptOperator">+</span> 0<span class="ActionScriptBracket/Brace">]</span> <span class="ActionScriptOperator">+</span> <span class="ActionScriptDefault_Text">data</span><span class="ActionScriptBracket/Brace">[</span><span class="ActionScriptDefault_Text">dataOff</span><span class="ActionScriptOperator">+</span>56<span class="ActionScriptBracket/Brace">]</span>;
            <span class="ActionScriptDefault_Text">tmp7</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">data</span><span class="ActionScriptBracket/Brace">[</span><span class="ActionScriptDefault_Text">dataOff</span><span class="ActionScriptOperator">+</span> 0<span class="ActionScriptBracket/Brace">]</span> <span class="ActionScriptOperator">-</span> <span class="ActionScriptDefault_Text">data</span><span class="ActionScriptBracket/Brace">[</span><span class="ActionScriptDefault_Text">dataOff</span><span class="ActionScriptOperator">+</span>56<span class="ActionScriptBracket/Brace">]</span>;
            <span class="ActionScriptDefault_Text">tmp1</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">data</span><span class="ActionScriptBracket/Brace">[</span><span class="ActionScriptDefault_Text">dataOff</span><span class="ActionScriptOperator">+</span> 8<span class="ActionScriptBracket/Brace">]</span> <span class="ActionScriptOperator">+</span> <span class="ActionScriptDefault_Text">data</span><span class="ActionScriptBracket/Brace">[</span><span class="ActionScriptDefault_Text">dataOff</span><span class="ActionScriptOperator">+</span>48<span class="ActionScriptBracket/Brace">]</span>;
            <span class="ActionScriptDefault_Text">tmp6</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">data</span><span class="ActionScriptBracket/Brace">[</span><span class="ActionScriptDefault_Text">dataOff</span><span class="ActionScriptOperator">+</span> 8<span class="ActionScriptBracket/Brace">]</span> <span class="ActionScriptOperator">-</span> <span class="ActionScriptDefault_Text">data</span><span class="ActionScriptBracket/Brace">[</span><span class="ActionScriptDefault_Text">dataOff</span><span class="ActionScriptOperator">+</span>48<span class="ActionScriptBracket/Brace">]</span>;
            <span class="ActionScriptDefault_Text">tmp2</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">data</span><span class="ActionScriptBracket/Brace">[</span><span class="ActionScriptDefault_Text">dataOff</span><span class="ActionScriptOperator">+</span>16<span class="ActionScriptBracket/Brace">]</span> <span class="ActionScriptOperator">+</span> <span class="ActionScriptDefault_Text">data</span><span class="ActionScriptBracket/Brace">[</span><span class="ActionScriptDefault_Text">dataOff</span><span class="ActionScriptOperator">+</span>40<span class="ActionScriptBracket/Brace">]</span>;
            <span class="ActionScriptDefault_Text">tmp5</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">data</span><span class="ActionScriptBracket/Brace">[</span><span class="ActionScriptDefault_Text">dataOff</span><span class="ActionScriptOperator">+</span>16<span class="ActionScriptBracket/Brace">]</span> <span class="ActionScriptOperator">-</span> <span class="ActionScriptDefault_Text">data</span><span class="ActionScriptBracket/Brace">[</span><span class="ActionScriptDefault_Text">dataOff</span><span class="ActionScriptOperator">+</span>40<span class="ActionScriptBracket/Brace">]</span>;
            <span class="ActionScriptDefault_Text">tmp3</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">data</span><span class="ActionScriptBracket/Brace">[</span><span class="ActionScriptDefault_Text">dataOff</span><span class="ActionScriptOperator">+</span>24<span class="ActionScriptBracket/Brace">]</span> <span class="ActionScriptOperator">+</span> <span class="ActionScriptDefault_Text">data</span><span class="ActionScriptBracket/Brace">[</span><span class="ActionScriptDefault_Text">dataOff</span><span class="ActionScriptOperator">+</span>32<span class="ActionScriptBracket/Brace">]</span>;
            <span class="ActionScriptDefault_Text">tmp4</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">data</span><span class="ActionScriptBracket/Brace">[</span><span class="ActionScriptDefault_Text">dataOff</span><span class="ActionScriptOperator">+</span>24<span class="ActionScriptBracket/Brace">]</span> <span class="ActionScriptOperator">-</span> <span class="ActionScriptDefault_Text">data</span><span class="ActionScriptBracket/Brace">[</span><span class="ActionScriptDefault_Text">dataOff</span><span class="ActionScriptOperator">+</span>32<span class="ActionScriptBracket/Brace">]</span>;

            <span class="ActionScriptComment">/* Even part */</span>
            <span class="ActionScriptDefault_Text">tmp10</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">tmp0</span> <span class="ActionScriptOperator">+</span> <span class="ActionScriptDefault_Text">tmp3</span>;    <span class="ActionScriptComment">/* phase 2 */</span>
            <span class="ActionScriptDefault_Text">tmp13</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">tmp0</span> <span class="ActionScriptOperator">-</span> <span class="ActionScriptDefault_Text">tmp3</span>;
            <span class="ActionScriptDefault_Text">tmp11</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">tmp1</span> <span class="ActionScriptOperator">+</span> <span class="ActionScriptDefault_Text">tmp2</span>;
            <span class="ActionScriptDefault_Text">tmp12</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">tmp1</span> <span class="ActionScriptOperator">-</span> <span class="ActionScriptDefault_Text">tmp2</span>;

            <span class="ActionScriptDefault_Text">data</span><span class="ActionScriptBracket/Brace">[</span><span class="ActionScriptDefault_Text">dataOff</span><span class="ActionScriptOperator">+</span> 0<span class="ActionScriptBracket/Brace">]</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">tmp10</span> <span class="ActionScriptOperator">+</span> <span class="ActionScriptDefault_Text">tmp11</span>; <span class="ActionScriptComment">/* phase 3 */</span>
            <span class="ActionScriptDefault_Text">data</span><span class="ActionScriptBracket/Brace">[</span><span class="ActionScriptDefault_Text">dataOff</span><span class="ActionScriptOperator">+</span>32<span class="ActionScriptBracket/Brace">]</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">tmp10</span> <span class="ActionScriptOperator">-</span> <span class="ActionScriptDefault_Text">tmp11</span>;

            <span class="ActionScriptDefault_Text">z1</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">tmp12</span> <span class="ActionScriptOperator">+</span> <span class="ActionScriptDefault_Text">tmp13</span><span class="ActionScriptBracket/Brace">)</span> <span class="ActionScriptOperator">*</span> 0.707106781; <span class="ActionScriptComment">/* c4 */</span>
            <span class="ActionScriptDefault_Text">data</span><span class="ActionScriptBracket/Brace">[</span><span class="ActionScriptDefault_Text">dataOff</span><span class="ActionScriptOperator">+</span>16<span class="ActionScriptBracket/Brace">]</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">tmp13</span> <span class="ActionScriptOperator">+</span> <span class="ActionScriptDefault_Text">z1</span>; <span class="ActionScriptComment">/* phase 5 */</span>
            <span class="ActionScriptDefault_Text">data</span><span class="ActionScriptBracket/Brace">[</span><span class="ActionScriptDefault_Text">dataOff</span><span class="ActionScriptOperator">+</span>48<span class="ActionScriptBracket/Brace">]</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">tmp13</span> <span class="ActionScriptOperator">-</span> <span class="ActionScriptDefault_Text">z1</span>;

            <span class="ActionScriptComment">/* Odd part */</span>
            <span class="ActionScriptDefault_Text">tmp10</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">tmp4</span> <span class="ActionScriptOperator">+</span> <span class="ActionScriptDefault_Text">tmp5</span>; <span class="ActionScriptComment">/* phase 2 */</span>
            <span class="ActionScriptDefault_Text">tmp11</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">tmp5</span> <span class="ActionScriptOperator">+</span> <span class="ActionScriptDefault_Text">tmp6</span>;
            <span class="ActionScriptDefault_Text">tmp12</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">tmp6</span> <span class="ActionScriptOperator">+</span> <span class="ActionScriptDefault_Text">tmp7</span>;

            <span class="ActionScriptComment">/* The rotator is modified from fig 4-8 to avoid extra negations. */</span>
            <span class="ActionScriptDefault_Text">z5</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">tmp10</span> <span class="ActionScriptOperator">-</span> <span class="ActionScriptDefault_Text">tmp12</span><span class="ActionScriptBracket/Brace">)</span> <span class="ActionScriptOperator">*</span> 0.382683433; <span class="ActionScriptComment">/* c6 */</span>
            <span class="ActionScriptDefault_Text">z2</span> <span class="ActionScriptOperator">=</span> 0.541196100 <span class="ActionScriptOperator">*</span> <span class="ActionScriptDefault_Text">tmp10</span> <span class="ActionScriptOperator">+</span> <span class="ActionScriptDefault_Text">z5</span>; <span class="ActionScriptComment">/* c2-c6 */</span>
            <span class="ActionScriptDefault_Text">z4</span> <span class="ActionScriptOperator">=</span> 1.306562965 <span class="ActionScriptOperator">*</span> <span class="ActionScriptDefault_Text">tmp12</span> <span class="ActionScriptOperator">+</span> <span class="ActionScriptDefault_Text">z5</span>; <span class="ActionScriptComment">/* c2+c6 */</span>
            <span class="ActionScriptDefault_Text">z3</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">tmp11</span> <span class="ActionScriptOperator">*</span> 0.707106781; <span class="ActionScriptComment">/* c4 */</span>

            <span class="ActionScriptDefault_Text">z11</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">tmp7</span> <span class="ActionScriptOperator">+</span> <span class="ActionScriptDefault_Text">z3</span>;    <span class="ActionScriptComment">/* phase 5 */</span>
            <span class="ActionScriptDefault_Text">z13</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">tmp7</span> <span class="ActionScriptOperator">-</span> <span class="ActionScriptDefault_Text">z3</span>;

            <span class="ActionScriptDefault_Text">data</span><span class="ActionScriptBracket/Brace">[</span><span class="ActionScriptDefault_Text">dataOff</span><span class="ActionScriptOperator">+</span>40<span class="ActionScriptBracket/Brace">]</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">z13</span> <span class="ActionScriptOperator">+</span> <span class="ActionScriptDefault_Text">z2</span>; <span class="ActionScriptComment">/* phase 6 */</span>
            <span class="ActionScriptDefault_Text">data</span><span class="ActionScriptBracket/Brace">[</span><span class="ActionScriptDefault_Text">dataOff</span><span class="ActionScriptOperator">+</span>24<span class="ActionScriptBracket/Brace">]</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">z13</span> <span class="ActionScriptOperator">-</span> <span class="ActionScriptDefault_Text">z2</span>;
            <span class="ActionScriptDefault_Text">data</span><span class="ActionScriptBracket/Brace">[</span><span class="ActionScriptDefault_Text">dataOff</span><span class="ActionScriptOperator">+</span> 8<span class="ActionScriptBracket/Brace">]</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">z11</span> <span class="ActionScriptOperator">+</span> <span class="ActionScriptDefault_Text">z4</span>;
            <span class="ActionScriptDefault_Text">data</span><span class="ActionScriptBracket/Brace">[</span><span class="ActionScriptDefault_Text">dataOff</span><span class="ActionScriptOperator">+</span>56<span class="ActionScriptBracket/Brace">]</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">z11</span> <span class="ActionScriptOperator">-</span> <span class="ActionScriptDefault_Text">z4</span>;

            <span class="ActionScriptDefault_Text">dataOff</span><span class="ActionScriptOperator">++</span>; <span class="ActionScriptComment">/* advance pointer to next column */</span>
        <span class="ActionScriptBracket/Brace">}</span>

        <span class="ActionScriptComment">// Quantize/descale the coefficients
</span>        <span class="ActionScriptReserved">for</span> <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">i</span> <span class="ActionScriptOperator">=</span> 0; <span class="ActionScriptDefault_Text">i</span> <span class="ActionScriptOperator">&lt;</span> 64; <span class="ActionScriptDefault_Text">i</span><span class="ActionScriptOperator">++</span><span class="ActionScriptBracket/Brace">)</span>
        <span class="ActionScriptBracket/Brace">{</span>
            <span class="ActionScriptComment">// Apply the quantization and scaling factor &amp; Round to nearest integer
</span>            <span class="ActionScriptDefault_Text">data</span><span class="ActionScriptBracket/Brace">[</span><span class="ActionScriptDefault_Text">i</span><span class="ActionScriptBracket/Brace">]</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">Math</span>.<span class="ActionScriptDefault_Text">round</span><span class="ActionScriptBracket/Brace">((</span><span class="ActionScriptDefault_Text">data</span><span class="ActionScriptBracket/Brace">[</span><span class="ActionScriptDefault_Text">i</span><span class="ActionScriptBracket/Brace">]</span><span class="ActionScriptOperator">*</span><span class="ActionScriptDefault_Text">fdtbl</span><span class="ActionScriptBracket/Brace">[</span><span class="ActionScriptDefault_Text">i</span><span class="ActionScriptBracket/Brace">]))</span>;
        <span class="ActionScriptBracket/Brace">}</span>
        <span class="ActionScriptReserved">return</span> <span class="ActionScriptDefault_Text">data</span>;
    <span class="ActionScriptBracket/Brace">}</span>

    <span class="ActionScriptComment">// Chunk writing
</span>
    <span class="ActionScriptReserved">private</span> <span class="ActionScriptfunction">function</span> <span class="ActionScriptDefault_Text">writeAPP0</span><span class="ActionScriptBracket/Brace">()</span><span class="ActionScriptOperator">:</span><span class="ActionScriptReserved">void</span>
    <span class="ActionScriptBracket/Brace">{</span>
        <span class="ActionScriptDefault_Text">writeWord</span><span class="ActionScriptBracket/Brace">(</span>0<span class="ActionScriptDefault_Text">xFFE0</span><span class="ActionScriptBracket/Brace">)</span>; <span class="ActionScriptComment">// marker
</span>        <span class="ActionScriptDefault_Text">writeWord</span><span class="ActionScriptBracket/Brace">(</span>16<span class="ActionScriptBracket/Brace">)</span>; <span class="ActionScriptComment">// length
</span>        <span class="ActionScriptDefault_Text">writeByte</span><span class="ActionScriptBracket/Brace">(</span>0<span class="ActionScriptDefault_Text">x4A</span><span class="ActionScriptBracket/Brace">)</span>; <span class="ActionScriptComment">// J
</span>        <span class="ActionScriptDefault_Text">writeByte</span><span class="ActionScriptBracket/Brace">(</span>0<span class="ActionScriptDefault_Text">x46</span><span class="ActionScriptBracket/Brace">)</span>; <span class="ActionScriptComment">// F
</span>        <span class="ActionScriptDefault_Text">writeByte</span><span class="ActionScriptBracket/Brace">(</span>0<span class="ActionScriptDefault_Text">x49</span><span class="ActionScriptBracket/Brace">)</span>; <span class="ActionScriptComment">// I
</span>        <span class="ActionScriptDefault_Text">writeByte</span><span class="ActionScriptBracket/Brace">(</span>0<span class="ActionScriptDefault_Text">x46</span><span class="ActionScriptBracket/Brace">)</span>; <span class="ActionScriptComment">// F
</span>        <span class="ActionScriptDefault_Text">writeByte</span><span class="ActionScriptBracket/Brace">(</span>0<span class="ActionScriptBracket/Brace">)</span>; <span class="ActionScriptComment">// = &quot;JFIF&quot;,&apos;\0&apos;
</span>        <span class="ActionScriptDefault_Text">writeByte</span><span class="ActionScriptBracket/Brace">(</span>1<span class="ActionScriptBracket/Brace">)</span>; <span class="ActionScriptComment">// versionhi
</span>        <span class="ActionScriptDefault_Text">writeByte</span><span class="ActionScriptBracket/Brace">(</span>1<span class="ActionScriptBracket/Brace">)</span>; <span class="ActionScriptComment">// versionlo
</span>        <span class="ActionScriptDefault_Text">writeByte</span><span class="ActionScriptBracket/Brace">(</span>0<span class="ActionScriptBracket/Brace">)</span>; <span class="ActionScriptComment">// xyunits
</span>        <span class="ActionScriptDefault_Text">writeWord</span><span class="ActionScriptBracket/Brace">(</span>1<span class="ActionScriptBracket/Brace">)</span>; <span class="ActionScriptComment">// xdensity
</span>        <span class="ActionScriptDefault_Text">writeWord</span><span class="ActionScriptBracket/Brace">(</span>1<span class="ActionScriptBracket/Brace">)</span>; <span class="ActionScriptComment">// ydensity
</span>        <span class="ActionScriptDefault_Text">writeByte</span><span class="ActionScriptBracket/Brace">(</span>0<span class="ActionScriptBracket/Brace">)</span>; <span class="ActionScriptComment">// thumbnwidth
</span>        <span class="ActionScriptDefault_Text">writeByte</span><span class="ActionScriptBracket/Brace">(</span>0<span class="ActionScriptBracket/Brace">)</span>; <span class="ActionScriptComment">// thumbnheight
</span>    <span class="ActionScriptBracket/Brace">}</span>

    <span class="ActionScriptReserved">private</span> <span class="ActionScriptfunction">function</span> <span class="ActionScriptDefault_Text">writeSOF0</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">width</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">int</span>, <span class="ActionScriptDefault_Text">height</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">int</span><span class="ActionScriptBracket/Brace">)</span><span class="ActionScriptOperator">:</span><span class="ActionScriptReserved">void</span>
    <span class="ActionScriptBracket/Brace">{</span>
        <span class="ActionScriptDefault_Text">writeWord</span><span class="ActionScriptBracket/Brace">(</span>0<span class="ActionScriptDefault_Text">xFFC0</span><span class="ActionScriptBracket/Brace">)</span>; <span class="ActionScriptComment">// marker
</span>        <span class="ActionScriptDefault_Text">writeWord</span><span class="ActionScriptBracket/Brace">(</span>17<span class="ActionScriptBracket/Brace">)</span>;   <span class="ActionScriptComment">// length, truecolor YUV JPG
</span>        <span class="ActionScriptDefault_Text">writeByte</span><span class="ActionScriptBracket/Brace">(</span>8<span class="ActionScriptBracket/Brace">)</span>;    <span class="ActionScriptComment">// precision
</span>        <span class="ActionScriptDefault_Text">writeWord</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">height</span><span class="ActionScriptBracket/Brace">)</span>;
        <span class="ActionScriptDefault_Text">writeWord</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">width</span><span class="ActionScriptBracket/Brace">)</span>;
        <span class="ActionScriptDefault_Text">writeByte</span><span class="ActionScriptBracket/Brace">(</span>3<span class="ActionScriptBracket/Brace">)</span>;    <span class="ActionScriptComment">// nrofcomponents
</span>        <span class="ActionScriptDefault_Text">writeByte</span><span class="ActionScriptBracket/Brace">(</span>1<span class="ActionScriptBracket/Brace">)</span>;    <span class="ActionScriptComment">// IdY
</span>        <span class="ActionScriptDefault_Text">writeByte</span><span class="ActionScriptBracket/Brace">(</span>0<span class="ActionScriptDefault_Text">x11</span><span class="ActionScriptBracket/Brace">)</span>; <span class="ActionScriptComment">// HVY
</span>        <span class="ActionScriptDefault_Text">writeByte</span><span class="ActionScriptBracket/Brace">(</span>0<span class="ActionScriptBracket/Brace">)</span>;    <span class="ActionScriptComment">// QTY
</span>        <span class="ActionScriptDefault_Text">writeByte</span><span class="ActionScriptBracket/Brace">(</span>2<span class="ActionScriptBracket/Brace">)</span>;    <span class="ActionScriptComment">// IdU
</span>        <span class="ActionScriptDefault_Text">writeByte</span><span class="ActionScriptBracket/Brace">(</span>0<span class="ActionScriptDefault_Text">x11</span><span class="ActionScriptBracket/Brace">)</span>; <span class="ActionScriptComment">// HVU
</span>        <span class="ActionScriptDefault_Text">writeByte</span><span class="ActionScriptBracket/Brace">(</span>1<span class="ActionScriptBracket/Brace">)</span>;    <span class="ActionScriptComment">// QTU
</span>        <span class="ActionScriptDefault_Text">writeByte</span><span class="ActionScriptBracket/Brace">(</span>3<span class="ActionScriptBracket/Brace">)</span>;    <span class="ActionScriptComment">// IdV
</span>        <span class="ActionScriptDefault_Text">writeByte</span><span class="ActionScriptBracket/Brace">(</span>0<span class="ActionScriptDefault_Text">x11</span><span class="ActionScriptBracket/Brace">)</span>; <span class="ActionScriptComment">// HVV
</span>        <span class="ActionScriptDefault_Text">writeByte</span><span class="ActionScriptBracket/Brace">(</span>1<span class="ActionScriptBracket/Brace">)</span>;    <span class="ActionScriptComment">// QTV
</span>    <span class="ActionScriptBracket/Brace">}</span>

    <span class="ActionScriptReserved">private</span> <span class="ActionScriptfunction">function</span> <span class="ActionScriptDefault_Text">writeDQT</span><span class="ActionScriptBracket/Brace">()</span><span class="ActionScriptOperator">:</span><span class="ActionScriptReserved">void</span>
    <span class="ActionScriptBracket/Brace">{</span>
        <span class="ActionScriptDefault_Text">writeWord</span><span class="ActionScriptBracket/Brace">(</span>0<span class="ActionScriptDefault_Text">xFFDB</span><span class="ActionScriptBracket/Brace">)</span>; <span class="ActionScriptComment">// marker
</span>        <span class="ActionScriptDefault_Text">writeWord</span><span class="ActionScriptBracket/Brace">(</span>132<span class="ActionScriptBracket/Brace">)</span>;       <span class="ActionScriptComment">// length
</span>        <span class="ActionScriptDefault_Text">writeByte</span><span class="ActionScriptBracket/Brace">(</span>0<span class="ActionScriptBracket/Brace">)</span>;
        <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">i</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">int</span>;

        <span class="ActionScriptReserved">for</span> <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">i</span> <span class="ActionScriptOperator">=</span> 0; <span class="ActionScriptDefault_Text">i</span> <span class="ActionScriptOperator">&lt;</span> 64; <span class="ActionScriptDefault_Text">i</span><span class="ActionScriptOperator">++</span><span class="ActionScriptBracket/Brace">)</span>
        <span class="ActionScriptBracket/Brace">{</span>
            <span class="ActionScriptDefault_Text">writeByte</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">YTable</span><span class="ActionScriptBracket/Brace">[</span><span class="ActionScriptDefault_Text">i</span><span class="ActionScriptBracket/Brace">])</span>;
        <span class="ActionScriptBracket/Brace">}</span>

        <span class="ActionScriptDefault_Text">writeByte</span><span class="ActionScriptBracket/Brace">(</span>1<span class="ActionScriptBracket/Brace">)</span>;

        <span class="ActionScriptReserved">for</span> <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">i</span> <span class="ActionScriptOperator">=</span> 0; <span class="ActionScriptDefault_Text">i</span> <span class="ActionScriptOperator">&lt;</span> 64; <span class="ActionScriptDefault_Text">i</span><span class="ActionScriptOperator">++</span><span class="ActionScriptBracket/Brace">)</span>
        <span class="ActionScriptBracket/Brace">{</span>
            <span class="ActionScriptDefault_Text">writeByte</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">UVTable</span><span class="ActionScriptBracket/Brace">[</span><span class="ActionScriptDefault_Text">i</span><span class="ActionScriptBracket/Brace">])</span>;
        <span class="ActionScriptBracket/Brace">}</span>
    <span class="ActionScriptBracket/Brace">}</span>

    <span class="ActionScriptReserved">private</span> <span class="ActionScriptfunction">function</span> <span class="ActionScriptDefault_Text">writeDHT</span><span class="ActionScriptBracket/Brace">()</span><span class="ActionScriptOperator">:</span><span class="ActionScriptReserved">void</span>
    <span class="ActionScriptBracket/Brace">{</span>
        <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">i</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">int</span>;

        <span class="ActionScriptDefault_Text">writeWord</span><span class="ActionScriptBracket/Brace">(</span>0<span class="ActionScriptDefault_Text">xFFC4</span><span class="ActionScriptBracket/Brace">)</span>; <span class="ActionScriptComment">// marker
</span>        <span class="ActionScriptDefault_Text">writeWord</span><span class="ActionScriptBracket/Brace">(</span>0<span class="ActionScriptDefault_Text">x01A2</span><span class="ActionScriptBracket/Brace">)</span>; <span class="ActionScriptComment">// length
</span>
        <span class="ActionScriptDefault_Text">writeByte</span><span class="ActionScriptBracket/Brace">(</span>0<span class="ActionScriptBracket/Brace">)</span>; <span class="ActionScriptComment">// HTYDCinfo
</span>        <span class="ActionScriptReserved">for</span> <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">i</span> <span class="ActionScriptOperator">=</span> 0; <span class="ActionScriptDefault_Text">i</span> <span class="ActionScriptOperator">&lt;</span> 16; <span class="ActionScriptDefault_Text">i</span><span class="ActionScriptOperator">++</span><span class="ActionScriptBracket/Brace">)</span>
        <span class="ActionScriptBracket/Brace">{</span>
            <span class="ActionScriptDefault_Text">writeByte</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">std_dc_luminance_nrcodes</span><span class="ActionScriptBracket/Brace">[</span><span class="ActionScriptDefault_Text">i</span><span class="ActionScriptOperator">+</span>1<span class="ActionScriptBracket/Brace">])</span>;
        <span class="ActionScriptBracket/Brace">}</span>

        <span class="ActionScriptReserved">for</span> <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">i</span> <span class="ActionScriptOperator">=</span> 0; <span class="ActionScriptDefault_Text">i</span> <span class="ActionScriptOperator">&lt;=</span> 11; <span class="ActionScriptDefault_Text">i</span><span class="ActionScriptOperator">++</span><span class="ActionScriptBracket/Brace">)</span>
        <span class="ActionScriptBracket/Brace">{</span>
            <span class="ActionScriptDefault_Text">writeByte</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">std_dc_luminance_values</span><span class="ActionScriptBracket/Brace">[</span><span class="ActionScriptDefault_Text">i</span><span class="ActionScriptBracket/Brace">])</span>;
        <span class="ActionScriptBracket/Brace">}</span>

        <span class="ActionScriptDefault_Text">writeByte</span><span class="ActionScriptBracket/Brace">(</span>0<span class="ActionScriptDefault_Text">x10</span><span class="ActionScriptBracket/Brace">)</span>; <span class="ActionScriptComment">// HTYACinfo
</span>        <span class="ActionScriptReserved">for</span> <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">i</span> <span class="ActionScriptOperator">=</span> 0; <span class="ActionScriptDefault_Text">i</span> <span class="ActionScriptOperator">&lt;</span> 16; <span class="ActionScriptDefault_Text">i</span><span class="ActionScriptOperator">++</span><span class="ActionScriptBracket/Brace">)</span>
        <span class="ActionScriptBracket/Brace">{</span>
            <span class="ActionScriptDefault_Text">writeByte</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">std_ac_luminance_nrcodes</span><span class="ActionScriptBracket/Brace">[</span><span class="ActionScriptDefault_Text">i</span><span class="ActionScriptOperator">+</span>1<span class="ActionScriptBracket/Brace">])</span>;
        <span class="ActionScriptBracket/Brace">}</span>

        <span class="ActionScriptReserved">for</span> <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">i</span> <span class="ActionScriptOperator">=</span> 0; <span class="ActionScriptDefault_Text">i</span><span class="ActionScriptOperator">&lt;=</span>161; <span class="ActionScriptDefault_Text">i</span><span class="ActionScriptOperator">++</span><span class="ActionScriptBracket/Brace">)</span>
        <span class="ActionScriptBracket/Brace">{</span>
            <span class="ActionScriptDefault_Text">writeByte</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">std_ac_luminance_values</span><span class="ActionScriptBracket/Brace">[</span><span class="ActionScriptDefault_Text">i</span><span class="ActionScriptBracket/Brace">])</span>;
        <span class="ActionScriptBracket/Brace">}</span>

        <span class="ActionScriptDefault_Text">writeByte</span><span class="ActionScriptBracket/Brace">(</span>1<span class="ActionScriptBracket/Brace">)</span>; <span class="ActionScriptComment">// HTUDCinfo
</span>        <span class="ActionScriptReserved">for</span> <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">i</span> <span class="ActionScriptOperator">=</span> 0; <span class="ActionScriptDefault_Text">i</span> <span class="ActionScriptOperator">&lt;</span> 16; <span class="ActionScriptDefault_Text">i</span><span class="ActionScriptOperator">++</span><span class="ActionScriptBracket/Brace">)</span>
        <span class="ActionScriptBracket/Brace">{</span>
            <span class="ActionScriptDefault_Text">writeByte</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">std_dc_chrominance_nrcodes</span><span class="ActionScriptBracket/Brace">[</span><span class="ActionScriptDefault_Text">i</span><span class="ActionScriptOperator">+</span>1<span class="ActionScriptBracket/Brace">])</span>;
        <span class="ActionScriptBracket/Brace">}</span>

        <span class="ActionScriptReserved">for</span> <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">i</span> <span class="ActionScriptOperator">=</span> 0; <span class="ActionScriptDefault_Text">i</span> <span class="ActionScriptOperator">&lt;=</span> 11; <span class="ActionScriptDefault_Text">i</span><span class="ActionScriptOperator">++</span><span class="ActionScriptBracket/Brace">)</span>
        <span class="ActionScriptBracket/Brace">{</span>
            <span class="ActionScriptDefault_Text">writeByte</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">std_dc_chrominance_values</span><span class="ActionScriptBracket/Brace">[</span><span class="ActionScriptDefault_Text">i</span><span class="ActionScriptBracket/Brace">])</span>;
        <span class="ActionScriptBracket/Brace">}</span>

        <span class="ActionScriptDefault_Text">writeByte</span><span class="ActionScriptBracket/Brace">(</span>0<span class="ActionScriptDefault_Text">x11</span><span class="ActionScriptBracket/Brace">)</span>; <span class="ActionScriptComment">// HTUACinfo
</span>        <span class="ActionScriptReserved">for</span> <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">i</span> <span class="ActionScriptOperator">=</span> 0; <span class="ActionScriptDefault_Text">i</span> <span class="ActionScriptOperator">&lt;</span> 16; <span class="ActionScriptDefault_Text">i</span><span class="ActionScriptOperator">++</span><span class="ActionScriptBracket/Brace">)</span>
        <span class="ActionScriptBracket/Brace">{</span>
            <span class="ActionScriptDefault_Text">writeByte</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">std_ac_chrominance_nrcodes</span><span class="ActionScriptBracket/Brace">[</span><span class="ActionScriptDefault_Text">i</span><span class="ActionScriptOperator">+</span>1<span class="ActionScriptBracket/Brace">])</span>;
        <span class="ActionScriptBracket/Brace">}</span>

        <span class="ActionScriptReserved">for</span> <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">i</span> <span class="ActionScriptOperator">=</span> 0; <span class="ActionScriptDefault_Text">i</span> <span class="ActionScriptOperator">&lt;=</span> 161; <span class="ActionScriptDefault_Text">i</span><span class="ActionScriptOperator">++</span><span class="ActionScriptBracket/Brace">)</span>
        <span class="ActionScriptBracket/Brace">{</span>
            <span class="ActionScriptDefault_Text">writeByte</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">std_ac_chrominance_values</span><span class="ActionScriptBracket/Brace">[</span><span class="ActionScriptDefault_Text">i</span><span class="ActionScriptBracket/Brace">])</span>;
        <span class="ActionScriptBracket/Brace">}</span>
    <span class="ActionScriptBracket/Brace">}</span>

    <span class="ActionScriptReserved">private</span> <span class="ActionScriptfunction">function</span> <span class="ActionScriptDefault_Text">writeSOS</span><span class="ActionScriptBracket/Brace">()</span><span class="ActionScriptOperator">:</span><span class="ActionScriptReserved">void</span>
    <span class="ActionScriptBracket/Brace">{</span>
        <span class="ActionScriptDefault_Text">writeWord</span><span class="ActionScriptBracket/Brace">(</span>0<span class="ActionScriptDefault_Text">xFFDA</span><span class="ActionScriptBracket/Brace">)</span>; <span class="ActionScriptComment">// marker
</span>        <span class="ActionScriptDefault_Text">writeWord</span><span class="ActionScriptBracket/Brace">(</span>12<span class="ActionScriptBracket/Brace">)</span>; <span class="ActionScriptComment">// length
</span>        <span class="ActionScriptDefault_Text">writeByte</span><span class="ActionScriptBracket/Brace">(</span>3<span class="ActionScriptBracket/Brace">)</span>; <span class="ActionScriptComment">// nrofcomponents
</span>        <span class="ActionScriptDefault_Text">writeByte</span><span class="ActionScriptBracket/Brace">(</span>1<span class="ActionScriptBracket/Brace">)</span>; <span class="ActionScriptComment">// IdY
</span>        <span class="ActionScriptDefault_Text">writeByte</span><span class="ActionScriptBracket/Brace">(</span>0<span class="ActionScriptBracket/Brace">)</span>; <span class="ActionScriptComment">// HTY
</span>        <span class="ActionScriptDefault_Text">writeByte</span><span class="ActionScriptBracket/Brace">(</span>2<span class="ActionScriptBracket/Brace">)</span>; <span class="ActionScriptComment">// IdU
</span>        <span class="ActionScriptDefault_Text">writeByte</span><span class="ActionScriptBracket/Brace">(</span>0<span class="ActionScriptDefault_Text">x11</span><span class="ActionScriptBracket/Brace">)</span>; <span class="ActionScriptComment">// HTU
</span>        <span class="ActionScriptDefault_Text">writeByte</span><span class="ActionScriptBracket/Brace">(</span>3<span class="ActionScriptBracket/Brace">)</span>; <span class="ActionScriptComment">// IdV
</span>        <span class="ActionScriptDefault_Text">writeByte</span><span class="ActionScriptBracket/Brace">(</span>0<span class="ActionScriptDefault_Text">x11</span><span class="ActionScriptBracket/Brace">)</span>; <span class="ActionScriptComment">// HTV
</span>        <span class="ActionScriptDefault_Text">writeByte</span><span class="ActionScriptBracket/Brace">(</span>0<span class="ActionScriptBracket/Brace">)</span>; <span class="ActionScriptComment">// Ss
</span>        <span class="ActionScriptDefault_Text">writeByte</span><span class="ActionScriptBracket/Brace">(</span>0<span class="ActionScriptDefault_Text">x3f</span><span class="ActionScriptBracket/Brace">)</span>; <span class="ActionScriptComment">// Se
</span>        <span class="ActionScriptDefault_Text">writeByte</span><span class="ActionScriptBracket/Brace">(</span>0<span class="ActionScriptBracket/Brace">)</span>; <span class="ActionScriptComment">// Bf
</span>    <span class="ActionScriptBracket/Brace">}</span>

    <span class="ActionScriptComment">// Core processing
</span>    <span class="ActionScriptReserved">private</span> <span class="ActionScriptfunction">function</span> <span class="ActionScriptDefault_Text">processDU</span><span class="ActionScriptBracket/Brace">(CD</span><span class="ActionScriptDefault_Text">U</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">Array</span>, <span class="ActionScriptDefault_Text">fdtbl</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">Array</span>, <span class="ActionScriptDefault_Text">DC</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">Number</span>, <span class="ActionScriptDefault_Text">HTDC</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">Array</span>, <span class="ActionScriptDefault_Text">HTAC</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">Array</span><span class="ActionScriptBracket/Brace">)</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">Number</span>
    <span class="ActionScriptBracket/Brace">{</span>
        <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">EOB</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">BitString</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">HTAC</span><span class="ActionScriptBracket/Brace">[</span>0<span class="ActionScriptDefault_Text">x00</span><span class="ActionScriptBracket/Brace">]</span>;
        <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">M16zeroes</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">BitString</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">HTAC</span><span class="ActionScriptBracket/Brace">[</span>0<span class="ActionScriptDefault_Text">xF0</span><span class="ActionScriptBracket/Brace">]</span>;
        <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">i</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">int</span>;

        <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">DU_DCT</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">Array</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">fDCTQuant</span><span class="ActionScriptBracket/Brace">(CD</span><span class="ActionScriptDefault_Text">U</span>, <span class="ActionScriptDefault_Text">fdtbl</span><span class="ActionScriptBracket/Brace">)</span>;
        <span class="ActionScriptComment">//ZigZag reorder
</span>        <span class="ActionScriptReserved">for</span> <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">i</span> <span class="ActionScriptOperator">=</span> 0; <span class="ActionScriptDefault_Text">i</span> <span class="ActionScriptOperator">&lt;</span> 64; <span class="ActionScriptDefault_Text">i</span><span class="ActionScriptOperator">++</span><span class="ActionScriptBracket/Brace">)</span>
        <span class="ActionScriptBracket/Brace">{</span>
            <span class="ActionScriptDefault_Text">DU</span><span class="ActionScriptBracket/Brace">[</span><span class="ActionScriptDefault_Text">ZigZag</span><span class="ActionScriptBracket/Brace">[</span><span class="ActionScriptDefault_Text">i</span><span class="ActionScriptBracket/Brace">]]</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">DU_DCT</span><span class="ActionScriptBracket/Brace">[</span><span class="ActionScriptDefault_Text">i</span><span class="ActionScriptBracket/Brace">]</span>;
        <span class="ActionScriptBracket/Brace">}</span>

        <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">Diff</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">int</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">DU</span><span class="ActionScriptBracket/Brace">[</span>0<span class="ActionScriptBracket/Brace">]</span> <span class="ActionScriptOperator">-</span> <span class="ActionScriptDefault_Text">DC</span>; <span class="ActionScriptDefault_Text">DC</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">DU</span><span class="ActionScriptBracket/Brace">[</span>0<span class="ActionScriptBracket/Brace">]</span>;
        <span class="ActionScriptComment">//Encode DC
</span>        <span class="ActionScriptReserved">if</span> <span class="ActionScriptBracket/Brace">(D</span><span class="ActionScriptDefault_Text">iff</span> <span class="ActionScriptOperator">==</span> 0<span class="ActionScriptBracket/Brace">)</span>
        <span class="ActionScriptBracket/Brace">{</span>
            <span class="ActionScriptDefault_Text">writeBits</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">HTDC</span><span class="ActionScriptBracket/Brace">[</span>0<span class="ActionScriptBracket/Brace">])</span>; <span class="ActionScriptComment">// Diff might be 0
</span>        <span class="ActionScriptBracket/Brace">}</span>
        <span class="ActionScriptReserved">else</span>
        <span class="ActionScriptBracket/Brace">{</span>
            <span class="ActionScriptDefault_Text">writeBits</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">HTDC</span><span class="ActionScriptBracket/Brace">[</span><span class="ActionScriptDefault_Text">category</span><span class="ActionScriptBracket/Brace">[</span>32767<span class="ActionScriptOperator">+</span><span class="ActionScriptDefault_Text">Diff</span><span class="ActionScriptBracket/Brace">]])</span>;
            <span class="ActionScriptDefault_Text">writeBits</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">bitcode</span><span class="ActionScriptBracket/Brace">[</span>32767<span class="ActionScriptOperator">+</span><span class="ActionScriptDefault_Text">Diff</span><span class="ActionScriptBracket/Brace">])</span>;
        <span class="ActionScriptBracket/Brace">}</span>
        <span class="ActionScriptComment">//Encode ACs
</span>        <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">end0pos</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">int</span> <span class="ActionScriptOperator">=</span> 63;
        <span class="ActionScriptReserved">for</span> <span class="ActionScriptBracket/Brace">(</span>; <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">end0pos</span><span class="ActionScriptOperator">&gt;</span>0<span class="ActionScriptBracket/Brace">)</span> <span class="ActionScriptOperator">&amp;&amp;</span> <span class="ActionScriptBracket/Brace">(D</span><span class="ActionScriptDefault_Text">U</span><span class="ActionScriptBracket/Brace">[</span><span class="ActionScriptDefault_Text">end0pos</span><span class="ActionScriptBracket/Brace">]</span><span class="ActionScriptOperator">==</span>0<span class="ActionScriptBracket/Brace">)</span>; <span class="ActionScriptDefault_Text">end0pos</span><span class="ActionScriptOperator">--</span><span class="ActionScriptBracket/Brace">)</span>
        <span class="ActionScriptBracket/Brace">{</span>
        <span class="ActionScriptBracket/Brace">}</span>;

        <span class="ActionScriptComment">//end0pos = first element in reverse order !=0
</span>        <span class="ActionScriptReserved">if</span> <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">end0pos</span> <span class="ActionScriptOperator">==</span> 0<span class="ActionScriptBracket/Brace">)</span>
        <span class="ActionScriptBracket/Brace">{</span>
            <span class="ActionScriptDefault_Text">writeBits</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">EOB</span><span class="ActionScriptBracket/Brace">)</span>;
            <span class="ActionScriptReserved">return</span> <span class="ActionScriptDefault_Text">DC</span>;
        <span class="ActionScriptBracket/Brace">}</span>

        <span class="ActionScriptDefault_Text">i</span> <span class="ActionScriptOperator">=</span> 1;
        <span class="ActionScriptReserved">while</span> <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">i</span> <span class="ActionScriptOperator">&lt;=</span> <span class="ActionScriptDefault_Text">end0pos</span><span class="ActionScriptBracket/Brace">)</span>
        <span class="ActionScriptBracket/Brace">{</span>
            <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">startpos</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">int</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">i</span>;
            <span class="ActionScriptReserved">for</span> <span class="ActionScriptBracket/Brace">(</span>; <span class="ActionScriptBracket/Brace">(D</span><span class="ActionScriptDefault_Text">U</span><span class="ActionScriptBracket/Brace">[</span><span class="ActionScriptDefault_Text">i</span><span class="ActionScriptBracket/Brace">]</span><span class="ActionScriptOperator">==</span>0<span class="ActionScriptBracket/Brace">)</span> <span class="ActionScriptOperator">&amp;&amp;</span> <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">i</span><span class="ActionScriptOperator">&lt;=</span><span class="ActionScriptDefault_Text">end0pos</span><span class="ActionScriptBracket/Brace">)</span>; <span class="ActionScriptDefault_Text">i</span><span class="ActionScriptOperator">++</span><span class="ActionScriptBracket/Brace">)</span>
            <span class="ActionScriptBracket/Brace">{</span>
            <span class="ActionScriptBracket/Brace">}</span>
            <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">nrzeroes</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">int</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">i</span><span class="ActionScriptOperator">-</span><span class="ActionScriptDefault_Text">startpos</span>;

            <span class="ActionScriptReserved">if</span> <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">nrzeroes</span> <span class="ActionScriptOperator">&gt;=</span> 16<span class="ActionScriptBracket/Brace">)</span>
            <span class="ActionScriptBracket/Brace">{</span>
                <span class="ActionScriptReserved">for</span> <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">nrmarker</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">int</span><span class="ActionScriptOperator">=</span>1; <span class="ActionScriptDefault_Text">nrmarker</span> <span class="ActionScriptOperator">&lt;=</span> <span class="ActionScriptDefault_Text">nrzeroes</span><span class="ActionScriptOperator">/</span>16; <span class="ActionScriptDefault_Text">nrmarker</span><span class="ActionScriptOperator">++</span><span class="ActionScriptBracket/Brace">)</span>
                <span class="ActionScriptBracket/Brace">{</span>
                    <span class="ActionScriptDefault_Text">writeBits</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">M16zeroes</span><span class="ActionScriptBracket/Brace">)</span>;
                <span class="ActionScriptBracket/Brace">}</span>
                <span class="ActionScriptDefault_Text">nrzeroes</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">int</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">nrzeroes</span><span class="ActionScriptOperator">&amp;</span>0<span class="ActionScriptDefault_Text">xF</span><span class="ActionScriptBracket/Brace">)</span>;
            <span class="ActionScriptBracket/Brace">}</span>

            <span class="ActionScriptDefault_Text">writeBits</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">HTAC</span><span class="ActionScriptBracket/Brace">[</span><span class="ActionScriptDefault_Text">nrzeroes</span> <span class="ActionScriptOperator">*</span> 16 <span class="ActionScriptOperator">+</span> <span class="ActionScriptDefault_Text">category</span><span class="ActionScriptBracket/Brace">[</span>32767 <span class="ActionScriptOperator">+</span> <span class="ActionScriptDefault_Text">DU</span><span class="ActionScriptBracket/Brace">[</span><span class="ActionScriptDefault_Text">i</span><span class="ActionScriptBracket/Brace">]]])</span>;
            <span class="ActionScriptDefault_Text">writeBits</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">bitcode</span><span class="ActionScriptBracket/Brace">[</span>32767 <span class="ActionScriptOperator">+</span> <span class="ActionScriptDefault_Text">DU</span><span class="ActionScriptBracket/Brace">[</span><span class="ActionScriptDefault_Text">i</span><span class="ActionScriptBracket/Brace">]])</span>;
            <span class="ActionScriptDefault_Text">i</span><span class="ActionScriptOperator">++</span>;
        <span class="ActionScriptBracket/Brace">}</span>

        <span class="ActionScriptReserved">if</span> <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">end0pos</span> <span class="ActionScriptOperator">!=</span> 63<span class="ActionScriptBracket/Brace">)</span>
        <span class="ActionScriptBracket/Brace">{</span>
            <span class="ActionScriptDefault_Text">writeBits</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">EOB</span><span class="ActionScriptBracket/Brace">)</span>;
        <span class="ActionScriptBracket/Brace">}</span>
        <span class="ActionScriptReserved">return</span> <span class="ActionScriptDefault_Text">DC</span>;
    <span class="ActionScriptBracket/Brace">}</span>

    <span class="ActionScriptReserved">private</span> <span class="ActionScriptfunction">function</span> <span class="ActionScriptDefault_Text">RGB2YUV</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">source</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">Object</span>, <span class="ActionScriptDefault_Text">xpos</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">int</span>, <span class="ActionScriptDefault_Text">ypos</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">int</span>, <span class="ActionScriptDefault_Text">width</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">int</span><span class="ActionScriptOperator">=</span>0, <span class="ActionScriptDefault_Text">height</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">int</span><span class="ActionScriptOperator">=</span>0<span class="ActionScriptBracket/Brace">)</span><span class="ActionScriptOperator">:</span><span class="ActionScriptReserved">void</span>
    <span class="ActionScriptBracket/Brace">{</span>
        <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">pos</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">int</span> <span class="ActionScriptOperator">=</span> 0;
        <span class="ActionScriptReserved">for</span> <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">y</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">int</span> <span class="ActionScriptOperator">=</span> 0; <span class="ActionScriptDefault_Text">y</span> <span class="ActionScriptOperator">&lt;</span> 8; <span class="ActionScriptDefault_Text">y</span><span class="ActionScriptOperator">++</span><span class="ActionScriptBracket/Brace">)</span>
        <span class="ActionScriptBracket/Brace">{</span>
            <span class="ActionScriptReserved">for</span> <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">x</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">int</span> <span class="ActionScriptOperator">=</span> 0; <span class="ActionScriptDefault_Text">x</span> <span class="ActionScriptOperator">&lt;</span> 8; <span class="ActionScriptDefault_Text">x</span><span class="ActionScriptOperator">++</span><span class="ActionScriptBracket/Brace">)</span>
            <span class="ActionScriptBracket/Brace">{</span>
                <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">P</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">uint</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">getPixel32</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">source</span>, <span class="ActionScriptDefault_Text">xpos</span><span class="ActionScriptOperator">+</span><span class="ActionScriptDefault_Text">x</span>, <span class="ActionScriptDefault_Text">ypos</span><span class="ActionScriptOperator">+</span><span class="ActionScriptDefault_Text">y</span>, <span class="ActionScriptDefault_Text">width</span>, <span class="ActionScriptDefault_Text">height</span><span class="ActionScriptBracket/Brace">)</span>;
                <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">R</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">Number</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">Number</span><span class="ActionScriptBracket/Brace">((</span><span class="ActionScriptDefault_Text">P</span><span class="ActionScriptOperator">&gt;&gt;</span>16<span class="ActionScriptBracket/Brace">)</span><span class="ActionScriptOperator">&amp;</span>0<span class="ActionScriptDefault_Text">xFF</span><span class="ActionScriptBracket/Brace">)</span>;
                <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">G</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">Number</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">Number</span><span class="ActionScriptBracket/Brace">((</span><span class="ActionScriptDefault_Text">P</span><span class="ActionScriptOperator">&gt;&gt;</span> 8<span class="ActionScriptBracket/Brace">)</span><span class="ActionScriptOperator">&amp;</span>0<span class="ActionScriptDefault_Text">xFF</span><span class="ActionScriptBracket/Brace">)</span>;
                <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">B</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">Number</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">Number</span><span class="ActionScriptBracket/Brace">((</span><span class="ActionScriptDefault_Text">P</span>    <span class="ActionScriptBracket/Brace">)</span><span class="ActionScriptOperator">&amp;</span>0<span class="ActionScriptDefault_Text">xFF</span><span class="ActionScriptBracket/Brace">)</span>;
                <span class="ActionScriptDefault_Text">YDU</span><span class="ActionScriptBracket/Brace">[</span><span class="ActionScriptDefault_Text">pos</span><span class="ActionScriptBracket/Brace">]</span><span class="ActionScriptOperator">=</span><span class="ActionScriptBracket/Brace">(((</span> 0.29900<span class="ActionScriptBracket/Brace">)</span><span class="ActionScriptOperator">*</span><span class="ActionScriptDefault_Text">R</span><span class="ActionScriptOperator">+</span><span class="ActionScriptBracket/Brace">(</span> 0.58700<span class="ActionScriptBracket/Brace">)</span><span class="ActionScriptOperator">*</span><span class="ActionScriptDefault_Text">G</span><span class="ActionScriptOperator">+</span><span class="ActionScriptBracket/Brace">(</span> 0.11400<span class="ActionScriptBracket/Brace">)</span><span class="ActionScriptOperator">*</span><span class="ActionScriptDefault_Text">B</span><span class="ActionScriptBracket/Brace">))</span><span class="ActionScriptOperator">-</span>128;
                <span class="ActionScriptDefault_Text">UDU</span><span class="ActionScriptBracket/Brace">[</span><span class="ActionScriptDefault_Text">pos</span><span class="ActionScriptBracket/Brace">]</span><span class="ActionScriptOperator">=</span><span class="ActionScriptBracket/Brace">(((</span><span class="ActionScriptOperator">-</span>0.16874<span class="ActionScriptBracket/Brace">)</span><span class="ActionScriptOperator">*</span><span class="ActionScriptDefault_Text">R</span><span class="ActionScriptOperator">+</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptOperator">-</span>0.33126<span class="ActionScriptBracket/Brace">)</span><span class="ActionScriptOperator">*</span><span class="ActionScriptDefault_Text">G</span><span class="ActionScriptOperator">+</span><span class="ActionScriptBracket/Brace">(</span> 0.50000<span class="ActionScriptBracket/Brace">)</span><span class="ActionScriptOperator">*</span><span class="ActionScriptDefault_Text">B</span><span class="ActionScriptBracket/Brace">))</span>;
                <span class="ActionScriptDefault_Text">VDU</span><span class="ActionScriptBracket/Brace">[</span><span class="ActionScriptDefault_Text">pos</span><span class="ActionScriptBracket/Brace">]</span><span class="ActionScriptOperator">=</span><span class="ActionScriptBracket/Brace">(((</span> 0.50000<span class="ActionScriptBracket/Brace">)</span><span class="ActionScriptOperator">*</span><span class="ActionScriptDefault_Text">R</span><span class="ActionScriptOperator">+</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptOperator">-</span>0.41869<span class="ActionScriptBracket/Brace">)</span><span class="ActionScriptOperator">*</span><span class="ActionScriptDefault_Text">G</span><span class="ActionScriptOperator">+</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptOperator">-</span>0.08131<span class="ActionScriptBracket/Brace">)</span><span class="ActionScriptOperator">*</span><span class="ActionScriptDefault_Text">B</span><span class="ActionScriptBracket/Brace">))</span>;
                <span class="ActionScriptDefault_Text">pos</span><span class="ActionScriptOperator">++</span>;
            <span class="ActionScriptBracket/Brace">}</span>
        <span class="ActionScriptBracket/Brace">}</span>
    <span class="ActionScriptBracket/Brace">}</span>

    <span class="ActionScriptASDoc">/**
     * Returns an unmultiplied ARGB color value (that contains alpha channel
     * data and RGB data) as an unsigned integer.
     */</span>
    <span class="ActionScriptReserved">private</span> <span class="ActionScriptfunction">function</span> <span class="ActionScriptDefault_Text">getPixel32</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">source</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">Object</span>, <span class="ActionScriptDefault_Text">x</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">int</span>, <span class="ActionScriptDefault_Text">y</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">int</span>, <span class="ActionScriptDefault_Text">width</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">int</span><span class="ActionScriptOperator">=</span>0, <span class="ActionScriptDefault_Text">height</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">int</span><span class="ActionScriptOperator">=</span>0<span class="ActionScriptBracket/Brace">)</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">uint</span>
    <span class="ActionScriptBracket/Brace">{</span>
        <span class="ActionScriptReserved">if</span> <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">source</span> <span class="ActionScriptReserved">is</span> <span class="ActionScriptDefault_Text">BitmapData</span><span class="ActionScriptBracket/Brace">)</span>
        <span class="ActionScriptBracket/Brace">{</span>
            <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">bitmap</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">BitmapData</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">source</span> <span class="ActionScriptReserved">as</span> <span class="ActionScriptDefault_Text">BitmapData</span>;
            <span class="ActionScriptReserved">return</span> <span class="ActionScriptDefault_Text">bitmap</span>.<span class="ActionScriptDefault_Text">getPixel32</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">x</span>, <span class="ActionScriptDefault_Text">y</span><span class="ActionScriptBracket/Brace">)</span>;
        <span class="ActionScriptBracket/Brace">}</span>
        <span class="ActionScriptReserved">else</span> <span class="ActionScriptReserved">if</span> <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">source</span> <span class="ActionScriptReserved">is</span> <span class="ActionScriptDefault_Text">ByteArray</span><span class="ActionScriptBracket/Brace">)</span>
        <span class="ActionScriptBracket/Brace">{</span>
            <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">byteArray</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">ByteArray</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">source</span> <span class="ActionScriptReserved">as</span> <span class="ActionScriptDefault_Text">ByteArray</span>;
            <span class="ActionScriptDefault_Text">byteArray</span>.<span class="ActionScriptDefault_Text">position</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptBracket/Brace">((</span><span class="ActionScriptDefault_Text">y</span> <span class="ActionScriptOperator">*</span> <span class="ActionScriptDefault_Text">width</span><span class="ActionScriptBracket/Brace">)</span> <span class="ActionScriptOperator">*</span> 4<span class="ActionScriptBracket/Brace">)</span> <span class="ActionScriptOperator">+</span> <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">x</span> <span class="ActionScriptOperator">*</span> 4<span class="ActionScriptBracket/Brace">)</span>;
            <span class="ActionScriptReserved">return</span> <span class="ActionScriptDefault_Text">byteArray</span>.<span class="ActionScriptDefault_Text">readUnsignedInt</span><span class="ActionScriptBracket/Brace">()</span>;
        <span class="ActionScriptBracket/Brace">}</span>
        <span class="ActionScriptReserved">else</span>
        <span class="ActionScriptBracket/Brace">{</span>
            <span class="ActionScriptReserved">throw</span> <span class="ActionScriptReserved">new</span> <span class="ActionScriptDefault_Text">ArgumentError</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptString">&quot;The source argument must be an instance of flash.display.BitmapData or flash.utils.ByteArray.&quot;</span><span class="ActionScriptBracket/Brace">)</span>;
        <span class="ActionScriptBracket/Brace">}</span>
    <span class="ActionScriptBracket/Brace">}</span>
<span class="ActionScriptBracket/Brace">}</span>
<span class="ActionScriptBracket/Brace">}</span>

<span class="ActionScriptclass">class</span> <span class="ActionScriptDefault_Text">BitString</span>
<span class="ActionScriptBracket/Brace">{</span>
    <span class="ActionScriptReserved">public</span> <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">len</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">int</span> <span class="ActionScriptOperator">=</span> 0;
    <span class="ActionScriptReserved">public</span> <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">val</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">int</span> <span class="ActionScriptOperator">=</span> 0;
<span class="ActionScriptBracket/Brace">}</span></pre></body>
</html>
